import{_ as i}from"./chunks/plugin-vue_export-helper.DlAUqK2U.js";import{c as a,o as n,ad as t}from"./chunks/mermaid.Cb40Nz1P.js";import"./chunks/cytoscape.C2CwDKBM.js";import"./chunks/dayjs.C32PoDnw.js";const c=JSON.parse('{"title":"流式 UI 模式 (Streaming UI)","description":"","frontmatter":{},"headers":[],"relativePath":"zh/tech/frontend/streaming.md","filePath":"zh/tech/frontend/streaming.md"}'),h={name:"zh/tech/frontend/streaming.md"};function l(k,s,e,p,r,E){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="流式-ui-模式-streaming-ui" tabindex="-1">流式 UI 模式 (Streaming UI) <a class="header-anchor" href="#流式-ui-模式-streaming-ui" aria-label="Permalink to &quot;流式 UI 模式 (Streaming UI)&quot;">​</a></h1><p>流式传输不仅仅是一个技术实现；它是 <strong>AI 用户体验</strong>的核心部分。本指南涵盖了如何渲染流，使其感觉流畅和神奇。</p><h2 id="延迟心理学" tabindex="-1">延迟心理学 <a class="header-anchor" href="#延迟心理学" aria-label="Permalink to &quot;延迟心理学&quot;">​</a></h2><ul><li><strong>&lt; 100ms</strong>: 感觉即时。</li><li><strong>&lt; 1s</strong>: 用户流未中断。</li><li><strong>&gt; 1s</strong>: 用户失去注意力。</li></ul><p>LLM 通常需要 2-10 秒才能完成。流式传输将 <strong>首个 Token 时间 (TTFT)</strong> 降低到 500ms 以下，保持用户参与。</p><h2 id="渲染策略" tabindex="-1">渲染策略 <a class="header-anchor" href="#渲染策略" aria-label="Permalink to &quot;渲染策略&quot;">​</a></h2><h3 id="_1-朴素追加-抖动方式" tabindex="-1">1. 朴素追加 (抖动方式) <a class="header-anchor" href="#_1-朴素追加-抖动方式" aria-label="Permalink to &quot;1. 朴素追加 (抖动方式)&quot;">​</a></h3><p>随着块的到达简单地添加可能会导致布局偏移和抖动。</p><h3 id="_2-节流渲染-平滑方式" tabindex="-1">2. 节流渲染 (平滑方式) <a class="header-anchor" href="#_2-节流渲染-平滑方式" aria-label="Permalink to &quot;2. 节流渲染 (平滑方式)&quot;">​</a></h3><p>以固定的帧率（例如 60fps）更新 DOM，而不是在每个网络数据包上更新。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 概念</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSmoothStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">display</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setDisplay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> display.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> interval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setDisplay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prev</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prev </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text[i]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 每个字符 10ms</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(interval);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [text]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> display;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="用于流式传输的-ui-组件" tabindex="-1">用于流式传输的 UI 组件 <a class="header-anchor" href="#用于流式传输的-ui-组件" aria-label="Permalink to &quot;用于流式传输的 UI 组件&quot;">​</a></h2><h3 id="思考中-状态" tabindex="-1">&quot;思考中&quot; 状态 <a class="header-anchor" href="#思考中-状态" aria-label="Permalink to &quot;&quot;思考中&quot; 状态&quot;">​</a></h3><p>在第一个 Token 到达之前，显示 AI 正在工作。</p><ul><li><strong>不要</strong>: 阻塞 UI。</li><li><strong>要</strong>: 显示骨架屏或微妙的“思考中...”指示器。</li></ul><h3 id="自动滚动" tabindex="-1">自动滚动 <a class="header-anchor" href="#自动滚动" aria-label="Permalink to &quot;自动滚动&quot;">​</a></h3><p>随着文本流入，聊天容器会增长。你必须保持底部可见，<em>除非</em>用户向上滚动查看历史记录。</p><p><strong>&quot;粘在底部&quot; 逻辑</strong>:</p><ol><li>如果用户在底部 -&gt; 自动滚动。</li><li>如果用户向上滚动 -&gt; 禁用自动滚动。</li><li>如果用户点击“滚动到底部” -&gt; 重新启用。</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自动滚动的 React Hook</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scrollToBottomRef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HTMLDivElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isAtBottom) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scrollToBottomRef.current?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scrollIntoView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ behavior: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;smooth&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, [messages]);</span></span></code></pre></div><h2 id="markdown-与语法高亮" tabindex="-1">Markdown 与语法高亮 <a class="header-anchor" href="#markdown-与语法高亮" aria-label="Permalink to &quot;Markdown 与语法高亮&quot;">​</a></h2><p>AI 输出 Markdown。在流式传输期间高效渲染它很棘手。</p><p><strong>性能提示</strong>: Memoize 你的 Markdown 渲染器。在每次字符更新时重新解析巨大的 Markdown 块是昂贵的。</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 React.memo 防止重新渲染以前的消息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MemoizedMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">memo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ReactMarkdown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{content}&lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ReactMarkdown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><h2 id="停止生成" tabindex="-1">停止生成 <a class="header-anchor" href="#停止生成" aria-label="Permalink to &quot;停止生成&quot;">​</a></h2><p>始终提供取消的方法。</p><ul><li><strong>原因</strong>: 模型可能会产生幻觉或误解。</li><li><strong>UX</strong>: 在生成期间用“停止”方形图标替换“发送”图标。</li></ul><h2 id="下一步" tabindex="-1">下一步 <a class="header-anchor" href="#下一步" aria-label="Permalink to &quot;下一步&quot;">​</a></h2><ul><li>查看 <strong><a href="./generative-ui.html">生成式 UI</a></strong> 了解流式组件。</li></ul>`,29)])])}const F=i(h,[["render",l]]);export{c as __pageData,F as default};
