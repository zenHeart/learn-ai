import{_ as n}from"./chunks/plugin-vue_export-helper.DlAUqK2U.js";import{C as l,c as p,o as a,ad as i,b as h,w as e,a as r,G as k,ae as o}from"./chunks/mermaid.Cb40Nz1P.js";import"./chunks/cytoscape.C2CwDKBM.js";import"./chunks/dayjs.C32PoDnw.js";const A=JSON.parse('{"title":"Project: AI SaaS (Full Stack)","description":"","frontmatter":{},"headers":[],"relativePath":"projects/advanced/full-stack-saas.md","filePath":"projects/advanced/full-stack-saas.md"}'),d={name:"projects/advanced/full-stack-saas.md"};function c(E,s,g,u,y,m){const t=l("Mermaid");return a(),p("div",null,[s[1]||(s[1]=i('<h1 id="project-ai-saas-full-stack" tabindex="-1">Project: AI SaaS (Full Stack) <a class="header-anchor" href="#project-ai-saas-full-stack" aria-label="Permalink to &quot;Project: AI SaaS (Full Stack)&quot;">​</a></h1><p><strong>Level</strong>: Advanced <strong>Time</strong>: 1-2 Weeks <strong>Stack</strong>: Next.js, Postgres, Stripe, Clerk, Vercel AI SDK</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Build a production-ready &quot;Chat with PDF&quot; SaaS platform where users pay a monthly subscription.</p><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2>',5)),(a(),h(o,null,{default:e(()=>[k(t,{id:"mermaid-15",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20User%20--%3E%7CAuth%7C%20Clerk%0A%20%20%20%20User%20--%3E%7CPayment%7C%20Stripe%0A%20%20%20%20User%20--%3E%7CChat%7C%20NextJS%0A%20%20%20%20NextJS%20--%3E%7CStore%7C%20Postgres(Supabase)%0A%20%20%20%20NextJS%20--%3E%7CAI%7C%20OpenAI%0A%20%20%20%20NextJS%20--%3E%7CUpload%7C%20R2%2FS3%0A"})]),fallback:e(()=>[...s[0]||(s[0]=[r(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=i(`<h2 id="step-1-authentication-clerk" tabindex="-1">Step 1: Authentication (Clerk) <a class="header-anchor" href="#step-1-authentication-clerk" aria-label="Permalink to &quot;Step 1: Authentication (Clerk)&quot;">​</a></h2><p>Protect your routes.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @clerk/nextjs</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// middleware.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { authMiddleware } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@clerk/nextjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> authMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  publicRoutes: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/webhook/stripe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="step-2-database-schema" tabindex="-1">Step 2: Database Schema <a class="header-anchor" href="#step-2-database-schema" aria-label="Permalink to &quot;Step 2: Database Schema&quot;">​</a></h2><p>You need to track:</p><ol><li><strong>Users</strong> (Subscription status)</li><li><strong>Files</strong> (Uploaded PDFs)</li><li><strong>Chats</strong> (History)</li><li><strong>Messages</strong></li></ol><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model User {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id String @id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  stripeCustomerId String?</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isPro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @default(false)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="step-3-payments-stripe" tabindex="-1">Step 3: Payments (Stripe) <a class="header-anchor" href="#step-3-payments-stripe" aria-label="Permalink to &quot;Step 3: Payments (Stripe)&quot;">​</a></h2><p>Create a Checkout Session.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/api/stripe/route.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stripe.checkout.sessions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  line_items: [{ price: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;price_123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, quantity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subscription&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  success_url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/dashboard\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  metadata: { userId: user.id },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="step-4-the-rag-pipeline" tabindex="-1">Step 4: The RAG Pipeline <a class="header-anchor" href="#step-4-the-rag-pipeline" aria-label="Permalink to &quot;Step 4: The RAG Pipeline&quot;">​</a></h2><p>When a user uploads a file:</p><ol><li><strong>Index</strong>: Read PDF -&gt; Chunk -&gt; Embed -&gt; Store in Pinecone/Supabase.</li><li><strong>Namespace</strong>: IMPORTANT! Tag vectors with <code>userId</code> or <code>fileId</code> so users can&#39;t search each other&#39;s files.</li></ol><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Metadata filter is CRITICAL for security</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> results</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vectorStore.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">similaritySearch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  userId: currentUser.id, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Only search my files</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="step-5-rate-limiting" tabindex="-1">Step 5: Rate Limiting <a class="header-anchor" href="#step-5-rate-limiting" aria-label="Permalink to &quot;Step 5: Rate Limiting&quot;">​</a></h2><p>Prevent abuse.</p><ul><li>Free Users: 5 messages/day.</li><li>Pro Users: 100 messages/day. Use <strong>Upstash Redis</strong> for this.</li></ul><h2 id="deployment-checklist" tabindex="-1">Deployment Checklist <a class="header-anchor" href="#deployment-checklist" aria-label="Permalink to &quot;Deployment Checklist&quot;">​</a></h2><ol><li>Environment Variables set in Vercel.</li><li>Stripe Webhooks configured.</li><li>Database migrations applied.</li><li>Domain DNS configured.</li></ol>`,20))])}const v=n(d,[["render",c]]);export{A as __pageData,v as default};
