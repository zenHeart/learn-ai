name: Deploy Site

on:
  push:
    branches:
      - master

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9

      - name: Install Dependencies
        run: pnpm install

      - name: Build Docs
        run: pnpm docs:build

      - name: Build All PPTs
        run: pnpm ppt:build

      - name: Prepare Dist
        run: |
          mkdir -p final_dist/ppts
          
          # Copy docs
          cp -r docs/.vitepress/dist/* final_dist/
          
          # Copy all PPT builds
          for ppt in prompt mcp vibe-coding; do
            if [ -d "ppts/${ppt}/dist" ]; then
              mkdir -p final_dist/ppts/${ppt}
              cp -r ppts/${ppt}/dist/* final_dist/ppts/${ppt}/
              echo "âœ“ Copied ${ppt}"
            fi
          done
          
          # Generate PPT index page
          cat > final_dist/ppts/index.html <<'EOF'
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AI PPTs</title>
    <style>
        :root { --bg:#fff; --text:#1a1a1a; --card:#f6f8fa; --border:#e1e4e8; --accent:#2ea44f; }
        @media(prefers-color-scheme:dark) { :root { --bg:#0d1117; --text:#c9d1d9; --card:#161b22; --border:#30363d; }}
        * { box-sizing:border-box; }
        body { font-family:system-ui,sans-serif; max-width:900px; margin:0 auto; padding:40px 20px; background:var(--bg); color:var(--text); }
        h1 { text-align:center; font-size:2.5rem; margin-bottom:40px; }
        .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; }
        .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:24px; transition:all .3s; text-decoration:none; color:inherit; display:block; }
        .card:hover { transform:translateY(-4px); box-shadow:0 8px 24px rgba(0,0,0,.15); border-color:var(--accent); }
        .card h2 { margin:0 0 10px; font-size:1.3rem; }
        .card p { margin:0; opacity:.8; font-size:.95rem; }
        .icon { font-size:2rem; margin-bottom:12px; }
        .footer { text-align:center; margin-top:40px; opacity:.7; }
        .footer a { color:var(--accent); text-decoration:none; }
    </style>
</head>
<body>
    <h1>ğŸ¯ AI å­¦ä¹ å¹»ç¯ç‰‡</h1>
    <div class="grid">
        <a href="/learn-ai/ppts/prompt/" class="card"><div class="icon">âœ¨</div><h2>Prompt Engineering</h2><p>æç¤ºå·¥ç¨‹æŠ€å·§ä¸å®æˆ˜</p></a>
        <a href="/learn-ai/ppts/mcp/" class="card"><div class="icon">ğŸ”Œ</div><h2>MCP Protocol</h2><p>Model Context Protocol è¯¦è§£</p></a>
        <a href="/learn-ai/ppts/vibe-coding/" class="card"><div class="icon">ğŸ¸</div><h2>Vibe Coding</h2><p>AI è¾…åŠ©ç¼–ç¨‹æ–°èŒƒå¼</p></a>
    </div>
    <p class="footer"><a href="/learn-ai/">â† è¿”å›æ–‡æ¡£é¦–é¡µ</a></p>
</body>
</html>
EOF
          
          touch final_dist/.nojekyll

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./final_dist
