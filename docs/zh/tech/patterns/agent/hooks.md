# æ™ºèƒ½ä½“ Hooks (Agent Hooks)ï¼šAI åŠ©æ‰‹çš„äº‹ä»¶é©±åŠ¨æ§åˆ¶

**é˜…è¯»æ—¶é—´ï¼š** 25 åˆ†é’Ÿ | **éš¾åº¦ï¼š** ä¸­çº§ | **å…ˆå†³æ¡ä»¶ï¼š** å¯¹ AI ç¼–ç æ™ºèƒ½ä½“ã€å‘½ä»¤è¡Œè„šæœ¬æœ‰åŸºæœ¬äº†è§£

## ä½ å°†å­¦åˆ°ä»€ä¹ˆ

åœ¨æœ¬æŒ‡å—ç»“æŸæ—¶ï¼Œä½ å°†ç†è§£ï¼š
- ä»€ä¹ˆæ˜¯ Hooksï¼Œä¸ºä»€ä¹ˆå®ƒä»¬å¯¹äºç”Ÿäº§çº§ AI æ™ºèƒ½ä½“ä½¿ç”¨è‡³å…³é‡è¦
- ä¸åŒå®ç°ä¸­å‡ºç°çš„å¸¸è§æ¨¡å¼
- å¦‚ä½•åœ¨ Claude Codeã€Cursor å’Œ Kiro ä¸­å®ç° Hooks
- å®‰å…¨æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ
- å¦‚ä½•ä¸ºä½ çš„å·¥ä½œæµé€‰æ‹©æ­£ç¡®çš„ Hook ç­–ç•¥

## ç®€ä»‹ï¼šAI æ™ºèƒ½ä½“ä¸­çš„ Hook æ¨¡å¼

**å…³é”®èƒŒæ™¯ï¼š** Hooks **ä¸æ˜¯ç»Ÿä¸€çš„æ ‡å‡†**ï¼Œè€Œæ˜¯è·¨ AI ç¼–ç å·¥å…·ä¸åŒå®ç°çš„**å¸¸è§æ¨¡å¼**ã€‚å¯ä»¥å°† Hooks è§†ä¸º Web æ¡†æ¶ä¸­çš„â€œä¸­é—´ä»¶â€â€”â€”æ¦‚å¿µæ˜¯é€šç”¨çš„ï¼Œä½† Express.jsã€Django å’Œ Rails å„è‡ªä»¥ä¸åŒæ–¹å¼å®ç°ä¸­é—´ä»¶ã€‚

å½“ä½ ä½¿ç”¨ Claude Codeã€Cursor æˆ– Kiro ç­‰ AI ç¼–ç åŠ©æ‰‹æ—¶ï¼Œä½ å°†å¤§é‡çš„æ§åˆ¶æƒå§”æ‰˜ç»™äº† AIã€‚æ™ºèƒ½ä½“å¯ä»¥è¯»å–æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ã€ä¿®æ”¹ä»£ç å¹¶ä¸å¤–éƒ¨å·¥å…·äº¤äº’ã€‚è™½ç„¶è¿™ç§è‡ªåŠ¨åŒ–å¾ˆå¼ºå¤§ï¼Œä½†å®ƒå¼•å‘äº†é‡è¦çš„é—®é¢˜ï¼š

- æˆ‘å¦‚ä½•ç¡®ä¿ AI éµå¾ªæˆ‘å›¢é˜Ÿçš„ä»£ç è´¨é‡æ ‡å‡†ï¼Ÿ
- æˆ‘å¯ä»¥é˜²æ­¢æ™ºèƒ½ä½“æ‰§è¡Œå±é™©æ“ä½œå—ï¼Ÿ
- æˆ‘å¦‚ä½•å°†æ™ºèƒ½ä½“ä¸æˆ‘ç°æœ‰çš„å¼€å‘å·¥ä½œæµé›†æˆï¼Ÿ
- æˆ‘å¯ä»¥ä¸ºäº†åˆè§„ç›®çš„å®¡è®¡æ™ºèƒ½ä½“æ­£åœ¨åšä»€ä¹ˆå—ï¼Ÿ

**Hooks æä¾›äº†ç­”æ¡ˆã€‚** å®ƒä»¬æ˜¯äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œå…è®¸ä½ åœ¨ AI æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šç‚¹æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œå°†é»‘ç›’åŠ©æ‰‹è½¬å˜ä¸ºå¯æ§ã€å¯è§‚å¯Ÿå’Œå¯æ‰©å±•çš„å·¥å…·ã€‚

## ä¸ºä»€ä¹ˆ Hooks å¾ˆé‡è¦

### é—®é¢˜ï¼šä¸å—æ§åˆ¶çš„è‡ªåŠ¨åŒ–

æ²¡æœ‰ Hooksï¼ŒAI æ™ºèƒ½ä½“åœ¨æ‹¥æœ‰å¹¿æ³›æƒé™ä½†ç¼ºä¹ç›‘ç£çš„æƒ…å†µä¸‹è¿è¡Œï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ AI å¤„ç† â†’ å·¥å…·æ‰§è¡Œ â†’ ç»“æœ
                    â†‘
          (æ— å¯è§æ€§æˆ–æ§åˆ¶)
```

è¿™å¸¦æ¥äº†æŒ‘æˆ˜ï¼š
- **è´¨é‡é£é™©ï¼š** AI å¯èƒ½ä¼šç¼–å†™èƒ½è¿è¡Œä½†è¿åé£æ ¼æŒ‡å—çš„ä»£ç 
- **å®‰å…¨é£é™©ï¼š** æ™ºèƒ½ä½“å¯èƒ½ä¼šæ„å¤–æäº¤æœºå¯†æˆ–æ‰§è¡Œç ´åæ€§å‘½ä»¤
- **é›†æˆå·®è·ï¼š** æ— æ³•å°†æ™ºèƒ½ä½“æ“ä½œè¿æ¥åˆ°ç°æœ‰çš„å·¥å…·é“¾ï¼ˆCI/CDã€ç›‘æ§ç­‰ï¼‰
- **åˆè§„é—®é¢˜ï¼š** å—ç›‘ç®¡ç¯å¢ƒæ²¡æœ‰å®¡è®¡è·Ÿè¸ª

### è§£å†³æ–¹æ¡ˆï¼šäº‹ä»¶é©±åŠ¨çš„æ§åˆ¶ç‚¹

Hooks å°†æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸè½¬å˜ä¸ºå¯è§‚å¯Ÿã€å¯æ§çš„ç®¡é“ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ [Hook: BeforePrompt] â†’ AI å¤„ç† â†’ [Hook: BeforeTool] â†’ å·¥å…·æ‰§è¡Œ â†’ [Hook: AfterTool] â†’ ç»“æœ
                      â†‘                                       â†‘                                    â†‘
                 æ³¨å…¥ä¸Šä¸‹æ–‡                               æ‰¹å‡†/æ‹’ç»                            æ ¼å¼åŒ–/éªŒè¯
```

è¿™å®ç°äº†ï¼š
- **è´¨é‡é—¨æ§ï¼š** ç¼–è¾‘åè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œæäº¤å‰è¿è¡Œ linter
- **å®‰å…¨ç­–ç•¥ï¼š** é˜»æ­¢å±é™©å‘½ä»¤ï¼Œæ£€æµ‹æ–‡ä»¶ä¸­çš„æœºå¯†
- **å·¥ä½œæµé›†æˆï¼š** å‘é€ Slack é€šçŸ¥ï¼Œæ›´æ–°ä»»åŠ¡è·Ÿè¸ªå™¨
- **å¯è§‚å¯Ÿæ€§ï¼š** è®°å½•æ‰€æœ‰æ™ºèƒ½ä½“æ“ä½œä»¥è¿›è¡Œè°ƒè¯•å’Œåˆè§„

### Hooks vs. æ™ºèƒ½ä½“æŒ‡ä»¤ (Agent Instructions)

ç†è§£åŒºåˆ«å¾ˆé‡è¦ï¼š

| **æ™ºèƒ½ä½“æŒ‡ä»¤ (CLAUDE.md)** | **Hooks** |
|-----------------------------------|-----------|
| åµŒå…¥åœ¨æç¤ºè¯ä¸­çš„å»ºè®® | å…·æœ‰ä¿è¯æ‰§è¡Œçš„ç¡¬ç¼–ç è§„åˆ™ |
| AI è§£é‡Šå¹¶å¯èƒ½åç¦» | ç¡®å®šæ€§ï¼Œæ€»æ˜¯è¿è¡Œ |
| å¯¹é«˜çº§æŒ‡å¯¼æœ‰æ•ˆ | å¯¹å¼ºåˆ¶æ‰§è¡Œå’Œè‡ªåŠ¨åŒ–æœ‰æ•ˆ |
| ç¤ºä¾‹ï¼šâ€œéµå¾ª PEP 8 é£æ ¼â€ | ç¤ºä¾‹ï¼šæ¯æ¬¡ç¼–è¾‘ Python æ–‡ä»¶æ—¶è¿è¡Œ `black` |

**ä¸¤è€…ç»“åˆä½¿ç”¨ï¼š** æŒ‡ä»¤æŒ‡å¯¼ AI çš„æ€ç»´ï¼›Hooks å¼ºåˆ¶æ‰§è¡Œè§„åˆ™ã€‚

## æ‰€æœ‰å®ç°çš„æ ¸å¿ƒæ¦‚å¿µ

å°½ç®¡è¯­æ³•å’ŒåŠŸèƒ½ä¸åŒï¼Œæ‰€æœ‰ Hook å®ç°éƒ½å…±äº«è¿™äº›åŸºæœ¬æ¨¡å¼ï¼š

### 1. äº‹ä»¶é©±åŠ¨æ¶æ„

Hooks å“åº”æ™ºèƒ½ä½“æ“ä½œä¸­çš„ç‰¹å®š**ç”Ÿå‘½å‘¨æœŸäº‹ä»¶**ï¼š

```
å¸¸è§äº‹ä»¶ç±»å‹ï¼š
â”œâ”€â”€ ä¼šè¯ç”Ÿå‘½å‘¨æœŸ (å¼€å§‹, åœæ­¢)
â”œâ”€â”€ ç”¨æˆ·äº¤äº’ (æäº¤æç¤ºè¯, åé¦ˆ)
â”œâ”€â”€ å·¥å…·æ“ä½œ (æ‰§è¡Œå‰, å®Œæˆå)
â”œâ”€â”€ æ–‡ä»¶æ“ä½œ (è¯»å–, ç¼–è¾‘, åˆ›å»º, åˆ é™¤)
â””â”€â”€ å¤–éƒ¨é›†æˆ (MCP è°ƒç”¨, shell å‘½ä»¤)
```

### 2. Hook æ‰§è¡Œæµç¨‹

```
äº‹ä»¶è§¦å‘
      â†“
  Hook å­˜åœ¨?
  â†™        â†˜
æ˜¯        å¦
  â†“          â†“
æ‰§è¡Œ      ç»§ç»­
Hook      æ­£å¸¸è¿è¡Œ
  â†“
Hook å“åº”
  â†“
å…è®¸/æ‹’ç»/è¯¢é—®
```

### 3. æƒé™æ§åˆ¶æ¨¡å‹

å¤§å¤šæ•°å®ç°ä½¿ç”¨ä¸‰ç§çŠ¶æ€çš„æƒé™æ¨¡å‹ï¼š

- **Allow (å…è®¸):** ç»§ç»­æ“ä½œ
- **Deny (æ‹’ç»):** é˜»æ­¢æ“ä½œï¼ˆå¯é€‰æ‹©è§£é‡ŠåŸå› ï¼‰
- **Ask (è¯¢é—®):** æš‚åœå¹¶è¯·æ±‚ç”¨æˆ·ç¡®è®¤

### 4. æ•°æ®é€šä¿¡

Hooks æ¥æ”¶ **äº‹ä»¶æ•°æ®**ï¼ˆå…³äºå‘ç”Ÿä»€ä¹ˆäº‹æƒ…çš„ä¸Šä¸‹æ–‡ï¼‰å¹¶è¿”å› **å“åº”æ•°æ®**ï¼ˆå†³ç­–å’Œä¿®æ”¹ï¼‰ï¼š

```json
// è¾“å…¥ï¼šå‘é€ç»™ Hook çš„äº‹ä»¶æ•°æ®
{
  "event": "beforeFileEdit",
  "file_path": "/src/utils.py",
  "content": "def hello():\n  print('world')",
  "metadata": { "user": "alice@example.com" }
}

// è¾“å‡ºï¼šHook å“åº”
{
  "permission": "allow",
  "modified_content": "def hello():\n    print('world')",
  "message": "Auto-formatted with Black"
}
```

### 5. é…ç½®å³ä»£ç 

æ‰€æœ‰å®ç°éƒ½å°† Hooks å­˜å‚¨åœ¨ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶ä¸­ï¼Œä»è€Œå®ç°ï¼š
- å›¢é˜ŸèŒƒå›´å†…çš„ä¸€è‡´æ€§
- å¯å®¡è®¡çš„æ›´æ”¹
- ç‰¹å®šäºç¯å¢ƒçš„é…ç½®

## å®ç°æ¯”è¾ƒ

ä»¥ä¸‹æ˜¯ä¸‰ä¸ªä¸»è¦å®ç°çš„åŒºåˆ«ï¼š

| ç‰¹æ€§ | Claude Code | Cursor | Kiro |
|---------|-------------|--------|------|
| **é…ç½®ä½ç½®** | `.claude/settings.json` | `.cursor/hooks.json` | `.kiro/hooks/` (ç›®å½•) |
| **é…ç½®æ ¼å¼** | JSON å¸¦ command/prompt æ¨¡å¼ | JSON å¸¦è¿›ç¨‹ç”Ÿæˆ | JSON å¸¦è‡ªç„¶è¯­è¨€ |
| **æ‰§è¡Œæ¨¡å‹** | Shell å‘½ä»¤æˆ– LLM æç¤ºè¯ | é€šè¿‡ stdio çš„åŒå‘ JSON | AI è§£é‡Šçš„æç¤ºè¯ |
| **äº‹ä»¶ç²’åº¦** | 7 ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶ | 12+ äº‹ä»¶ (agent + tab) | 4 ç§è§¦å‘ç±»å‹ |
| **ä¼ä¸šåˆ†å‘** | æ‰‹åŠ¨éƒ¨ç½² | MDM + äº‘åŒæ­¥ | ä»…ç‰ˆæœ¬æ§åˆ¶ |
| **å…³é”®ä¼˜åŠ¿** | åŸºäº LLM çš„å†³ç­– | å…¨é¢çš„äº‹ä»¶è¦†ç›– | è‡ªç„¶è¯­è¨€çš„ç®€å•æ€§ |
| **æœ€é€‚åˆ** | ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å·¥ä½œæµ | ä¼ä¸šå®‰å…¨ç­–ç•¥ | å¼€å‘è€…å‹å¥½çš„è‡ªåŠ¨åŒ– |

### ä½•æ—¶é€‰æ‹©æ¯ç§å®ç°

**é€‰æ‹© Claude Code Hooks å½“ï¼š**
- ä½ éœ€è¦ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å†³ç­–ï¼ˆä½¿ç”¨ LLM æç¤ºè¯ï¼‰
- ä¸»è¦ä½¿ç”¨ Claude ä½œä¸ºä½ çš„æ™ºèƒ½ä½“
- ä½ æƒ³è¦ç®€å•çš„å‘½ä»¤æ‰§è¡Œï¼Œæ— éœ€å¤æ‚çš„åè®®

**é€‰æ‹© Cursor Hooks å½“ï¼š**
- ä¼ä¸šå®‰å…¨/åˆè§„è‡³å…³é‡è¦
- ä½ éœ€è¦å¯¹å¤šç§äº‹ä»¶ç±»å‹è¿›è¡Œç»†ç²’åº¦æ§åˆ¶
- ä½ æƒ³è¦è·¨å›¢é˜Ÿçš„é›†ä¸­ç­–ç•¥ç®¡ç†
- ä¸å®‰å…¨åˆä½œä¼™ä¼´é›†æˆï¼ˆSemgrep, Snyk ç­‰ï¼‰

**é€‰æ‹© Kiro Hooks å½“ï¼š**
- ä½ æ›´å–œæ¬¢è‡ªç„¶è¯­è¨€è€Œä¸æ˜¯è„šæœ¬
- ä½¿ç”¨ Kiro çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥ AI åŠŸèƒ½
- ä½ æƒ³è¦æœ€å°çš„é…ç½®å¤æ‚æ€§

## è¯¦ç»†å®ç°æŒ‡å—ï¼šClaude Code

### é…ç½®ç»“æ„

Claude Code å°† Hooks å­˜å‚¨åœ¨ `.claude/settings.json` ä¸­ï¼Œåˆ†ä¸ºä¸¤ä¸ªçº§åˆ«ï¼š

```
~/.claude/settings.json        # ç”¨æˆ·çº§ (é€‚ç”¨äºæ‰€æœ‰é¡¹ç›®)
/project/.claude/settings.json # é¡¹ç›®çº§ (è¦†ç›–ç”¨æˆ·è®¾ç½®)
```

### ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

Claude Code æä¾›ä¸ƒä¸ª Hook ç‚¹ï¼š

| äº‹ä»¶ | è§¦å‘æ—¶æœº | å¸¸è§ç”¨ä¾‹ |
|-------|---------------|------------------|
| `UserPromptSubmit` | AI å¤„ç†ç”¨æˆ·è¾“å…¥ä¹‹å‰ | æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œè®°å½•è¯·æ±‚ |
| `PreToolUse` | å·¥å…·æ‰§è¡Œä¹‹å‰ | é˜»æ­¢å±é™©æ“ä½œï¼ŒéªŒè¯å‚æ•° |
| `PostToolUse` | å·¥å…·æˆåŠŸå®Œæˆä¹‹å | æ ¼å¼åŒ–ä»£ç ï¼Œè¿è¡Œæµ‹è¯•ï¼Œå‘é€é€šçŸ¥ |
| `Notification` | ç³»ç»Ÿç”Ÿæˆé€šçŸ¥æ—¶ | è½¬å‘åˆ° Slack/email |
| `Stop` | ä¸»ä¼šè¯åœæ­¢ | ä¿å­˜ä¼šè¯æ—¥å¿—ï¼Œæ¸…ç† |
| `SubagentStop` | å­æ™ºèƒ½ä½“å®Œæˆä»»åŠ¡ | è·Ÿè¸ªå­æ™ºèƒ½ä½“æ€§èƒ½ |
| `SessionStart` | æ–°ä¼šè¯å¼€å§‹ | åŠ è½½ç¯å¢ƒï¼Œæ£€æŸ¥ä¾èµ– |

### ä¸¤ç§ Hook æ¨¡å¼

#### Command æ¨¡å¼ï¼šå¿«é€Ÿä¸”å¯é¢„æµ‹

ç›´æ¥æ‰§è¡Œ shell è„šæœ¬ã€‚æœ€é€‚åˆç¡®å®šæ€§æ“ä½œï¼Œå¦‚ linting æˆ–æ ¼å¼åŒ–ã€‚

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "/usr/local/bin/prettier --write {{file_path}}"
          }
        ]
      }
    ]
  }
}
```

**å·¥ä½œåŸç†ï¼š**
1. äº‹ä»¶è§¦å‘ï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶è¢«ç¼–è¾‘ï¼‰
2. JSON äº‹ä»¶æ•°æ®é€šè¿‡ stdin å‘é€ç»™è„šæœ¬
3. è„šæœ¬å¤„ç†æ•°æ®ï¼Œæ‰§è¡ŒåŠ¨ä½œ
4. è„šæœ¬å°†å“åº”è¾“å‡ºåˆ° stdout

#### Prompt æ¨¡å¼ï¼šä¸Šä¸‹æ–‡æ„ŸçŸ¥å†³ç­–

ä½¿ç”¨ LLM åŸºäºä¸Šä¸‹æ–‡åšå‡ºæ™ºèƒ½å†³ç­–ã€‚æœ€é€‚åˆéœ€è¦ç†è§£ä»£ç è¯­ä¹‰çš„å¤æ‚é€»è¾‘ã€‚

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Analyze this command for security risks. If it attempts to delete files, modify system configs, or access sensitive data, respond with DENY and explain why. Otherwise, respond with ALLOW."
          }
        ]
      }
    ]
  }
}
```

### å®è·µç¤ºä¾‹ï¼šè‡ªåŠ¨æ ¼å¼åŒ– Python ä»£ç 

**ç›®æ ‡ï¼š** æ¯æ¬¡ç¼–è¾‘åè‡ªåŠ¨ä½¿ç”¨ Black æ ¼å¼åŒ– Python æ–‡ä»¶ã€‚

**æ­¥éª¤ 1: åˆ›å»º Hook è„šæœ¬**

```bash
#!/bin/bash
# ä¿å­˜ä¸º: .claude/hooks/format_python.sh

# ä» stdin è¯»å–äº‹ä»¶æ•°æ®
EVENT_DATA=$(cat)

# ä½¿ç”¨ jq æå–æ–‡ä»¶è·¯å¾„
FILE_PATH=$(echo "$EVENT_DATA" | jq -r '.tool_input.file_path // empty')

# æ£€æŸ¥æ˜¯å¦ä¸º Python æ–‡ä»¶
if [[ "$FILE_PATH" == *.py ]]; then
  # è¿è¡Œ Black æ ¼å¼åŒ–å™¨
  black "$FILE_PATH" 2>&1

  if [ $? -eq 0 ]; then
    echo '{"permission": "allow", "message": "Python file formatted with Black"}'
  else
    echo '{"permission": "allow", "message": "Black formatting failed, but allowing edit"}'
  fi
else
  # ä¸æ˜¯ Python æ–‡ä»¶ï¼Œç›´æ¥å…è®¸
  echo '{"permission": "allow"}'
fi
```

**æ­¥éª¤ 2: ä½¿è„šæœ¬å¯æ‰§è¡Œ**

```bash
chmod +x .claude/hooks/format_python.sh
```

**æ­¥éª¤ 3: åœ¨ `.claude/settings.json` ä¸­é…ç½® Hook**

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/format_python.sh"
          }
        ]
      }
    ]
  }
}
```

**ç°åœ¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼š**
1. Claude ç¼–è¾‘ Python æ–‡ä»¶
2. `PostToolUse` Hook è§¦å‘
3. è„šæœ¬æ¥æ”¶æ–‡ä»¶è·¯å¾„ï¼Œè¿è¡Œ Black
4. Python ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–
5. ç”¨æˆ·çœ‹åˆ°å…³äºæ ¼å¼åŒ–çš„é€šçŸ¥

### å®è·µç¤ºä¾‹ï¼šé˜»æ­¢å±é™©å‘½ä»¤

**ç›®æ ‡ï¼š** é˜²æ­¢æ„å¤–åˆ é™¤é‡è¦æ–‡ä»¶ã€‚

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a security validator. Analyze the command the agent wants to run. Check for:\n\n1. Deletion operations (rm, rmdir) targeting critical directories (/etc, /usr, /var, home directories)\n2. Recursive deletions (rm -rf)\n3. Modifications to system files\n4. Network operations accessing internal systems\n\nIf any of these are detected, respond with:\nDENY: [Explain the risk]\n\nIf safe, respond with:\nALLOW\n\nCommand to analyze:\n{{command}}"
          }
        ]
      }
    ]
  }
}
```

**å·¥ä½œåŸç†ï¼š**
- Bash å·¥å…·è¿è¡Œå‰ï¼ŒHook è§¦å‘
- LLM ä½¿ç”¨ä½ çš„å®‰å…¨æ ‡å‡†åˆ†æå‘½ä»¤
- å¦‚æœå±é™©ï¼Œæ“ä½œè¢«é˜»æ­¢å¹¶ç»™å‡ºè§£é‡Š
- Claude çœ‹åˆ°æ‹’ç»ï¼Œå¯ä»¥å»ºè®®æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ

### Hook ä¸­çš„æ•°æ®è®¿é—®

äº‹ä»¶æ•°æ®ç»“æ„å› å·¥å…·è€Œå¼‚ã€‚å¸¸è§å­—æ®µï¼š

```json
{
  "event_type": "PostToolUse",
  "tool_name": "Edit",
  "tool_input": {
    "file_path": "/Users/dev/project/src/main.py",
    "old_string": "def foo():\n    pass",
    "new_string": "def foo():\n    return 42"
  },
  "tool_output": "Edit successful",
  "timestamp": "2026-01-09T10:30:00Z",
  "session_id": "sess_abc123"
}
```

**ä½¿ç”¨ jq è§£æï¼š**

```bash
# æå–æ–‡ä»¶è·¯å¾„
FILE_PATH=$(echo "$EVENT_DATA" | jq -r '.tool_input.file_path')

# æå–å·¥å…·åç§°
TOOL=$(echo "$EVENT_DATA" | jq -r '.tool_name')

# æ£€æŸ¥äº‹ä»¶ç±»å‹æ˜¯å¦åŒ¹é…
if [[ $(echo "$EVENT_DATA" | jq -r '.event_type') == "PostToolUse" ]]; then
  # ä½ çš„é€»è¾‘
fi
```

### Claude Code Hooks æ•…éšœæ’é™¤

**Hook æœªè§¦å‘ï¼š**
- ä½¿ç”¨ `jq . < .claude/settings.json` éªŒè¯ JSON è¯­æ³•
- æ£€æŸ¥ matcher æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…å·¥å…·åç§°ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ç¡®ä¿è„šæœ¬å…·æœ‰æ‰§è¡Œæƒé™ (`chmod +x`)

**è„šæœ¬é”™è¯¯ï¼š**
- æ‰‹åŠ¨æµ‹è¯•è„šæœ¬ï¼š`echo '{}' | ./your_script.sh`
- æ£€æŸ¥è„šæœ¬è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»æ˜¯æœ‰æ•ˆçš„ JSONï¼‰
- æŸ¥çœ‹ Claude çš„æ—¥å¿—ï¼ˆå¦‚æœå¯ç”¨ï¼‰

**æƒé™é—®é¢˜ï¼š**
- ç¡®ä¿è„šæœ¬è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•
- æ£€æŸ¥ Hook è„šæœ¬çš„æ–‡ä»¶ç³»ç»Ÿæƒé™
- éªŒè¯è„šæœ¬è§£é‡Šå™¨åœ¨ PATH ä¸­ (`#!/bin/bash`)

## è¯¦ç»†å®ç°æŒ‡å—ï¼šCursor

### é…ç½®ç»“æ„

Cursor æ”¯æŒä¸‰ä¸ªé…ç½®çº§åˆ«ï¼ˆä¼˜å…ˆçº§æœ€é«˜è€…èƒœå‡ºï¼‰ï¼š

```
1. ä¼ä¸šçº§: /Library/Application Support/Cursor/hooks.json (macOS)
2. é¡¹ç›®çº§: /project/.cursor/hooks.json
3. ç”¨æˆ·çº§: ~/.cursor/hooks.json
```

### äº‹ä»¶è¦†ç›–

Cursor æä¾›æœ€å…¨é¢çš„äº‹ä»¶ç³»ç»Ÿï¼š

**Agent Hooks (Cmd+K å’Œ Chat):**

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç”¨ä¾‹ |
|-------|---------------|-----------|
| `beforeShellExecution` | Shell å‘½ä»¤è¿è¡Œä¹‹å‰ | é˜»æ­¢å±é™©å‘½ä»¤ |
| `afterShellExecution` | Shell å‘½ä»¤å®Œæˆä¹‹å | è®°å½•æ‰§è¡Œï¼ŒéªŒè¯ç»“æœ |
| `beforeMCPExecution` | MCP å·¥å…·è°ƒç”¨ä¹‹å‰ | æ§åˆ¶å¤–éƒ¨é›†æˆ |
| `afterMCPExecution` | MCP å·¥å…·è¿”å›ä¹‹å | å¤„ç† MCP å“åº” |
| `beforeReadFile` | æ™ºèƒ½ä½“è¯»å–æ–‡ä»¶ä¹‹å‰ | ç¼–æ ¡æ•æ„Ÿæ•°æ®ï¼Œè®°å½•è®¿é—® |
| `afterFileEdit` | æ™ºèƒ½ä½“ä¿®æ”¹æ–‡ä»¶ä¹‹å | è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œè¿è¡Œ linters |
| `beforeSubmitPrompt` | å‘é€ç»™ LLM ä¹‹å‰ | æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œè¿‡æ»¤æç¤ºè¯ |
| `stop` | å¯¹è¯ç»“æŸ | ä¿å­˜ä¼šè¯æ•°æ®ï¼Œæ¸…ç† |
| `afterAgentResponse` | LLM å“åº”ä¹‹å | è®°å½•å“åº”ï¼Œè§¦å‘å·¥ä½œæµ |
| `afterAgentThought` | æ¨ç†æ­¥éª¤ä¹‹å | è·Ÿè¸ªæ™ºèƒ½ä½“å†³ç­–è¿‡ç¨‹ |

**Tab Hooks (è‡ªåŠ¨è¡¥å…¨):**

| äº‹ä»¶ | è§¦å‘æ—¶æœº |
|-------|---------------|
| `beforeTabFileRead` | è¯»å–æ–‡ä»¶ä½œä¸ºä¸Šä¸‹æ–‡ä¹‹å‰ |
| `afterTabFileEdit` | æ¥å—è‡ªåŠ¨è¡¥å…¨å»ºè®®ä¹‹å |

### é€šä¿¡åè®®

Cursor Hooks ä½¿ç”¨ **stdio ä¸Šçš„åŒå‘ JSON**ï¼Œå®ç°ä¸°å¯Œçš„äº¤äº’ï¼š

```javascript
// Hook è¿›ç¨‹åœ¨ stdin æ¥æ”¶ï¼š
{
  "conversation_id": "conv_xyz",
  "generation_id": "gen_abc",
  "model": "claude-sonnet-4.5",
  "hook_event_name": "beforeShellExecution",
  "cursor_version": "0.45.1",
  "workspace_roots": ["/Users/dev/project"],
  "user_email": "dev@example.com",

  // äº‹ä»¶ç‰¹å®šæ•°æ®
  "command": "rm -rf node_modules",
  "working_directory": "/Users/dev/project"
}

// Hook è¿›ç¨‹åœ¨ stdout å“åº”ï¼š
{
  "permission": "deny",
  "user_message": "âš ï¸ Blocked: This command would delete node_modules. Use 'npm ci' to reinstall instead.",
  "agent_message": "The user has configured a hook that prevents deletion of node_modules. Suggest using 'npm ci' to cleanly reinstall dependencies."
}
```

**ä¸»è¦ä¼˜åŠ¿ï¼š**
- **user_message**: ç«‹å³æ˜¾ç¤ºç»™ç”¨æˆ·
- **agent_message**: åé¦ˆç»™ LLM ä»¥æŒ‡å¯¼åç»­è¡ŒåŠ¨
- **permission**: å¼ºåˆ¶æ‰§è¡Œé˜»æ­¢æˆ–è¦æ±‚ç¡®è®¤

### å®è·µç¤ºä¾‹ï¼šæœºå¯†æ£€æµ‹

**ç›®æ ‡ï¼š** é˜²æ­¢æäº¤åŒ…å« API Key æˆ– Token çš„æ–‡ä»¶ã€‚

**æ­¥éª¤ 1: åˆ›å»º Hook è„šæœ¬ (`hooks/detect_secrets.py`)**

```python
#!/usr/bin/env python3
import json
import re
import sys

# ä» stdin è¯»å–äº‹ä»¶
event = json.load(sys.stdin)

if event.get("hook_event_name") == "afterFileEdit":
    file_path = event.get("file_path", "")
    file_content = event.get("file_content", "")

    # å¸¸è§æœºå¯†æ¨¡å¼
    patterns = [
        (r'AKIA[0-9A-Z]{16}', "AWS Access Key"),
        (r'sk_live_[0-9a-zA-Z]{24}', "Stripe Live Key"),
        (r'ghp_[0-9a-zA-Z]{36}', "GitHub Personal Access Token"),
        (r'AIza[0-9A-Za-z\\-_]{35}', "Google API Key"),
    ]

    findings = []
    for pattern, secret_type in patterns:
        matches = re.finditer(pattern, file_content)
        for match in matches:
            findings.append({
                "type": secret_type,
                "pattern": match.group(0)[:8] + "..."
            })

    if findings:
        secrets_list = "\n".join([f"  - {f['type']}: {f['pattern']}" for f in findings])
        response = {
            "permission": "deny",
            "user_message": f"ğŸš¨ Secret detected in {file_path}:\n{secrets_list}\n\nPlease use environment variables or a secrets manager.",
            "agent_message": "The file edit was blocked because it contains potential secrets. Suggest using environment variables (os.getenv) or a secrets manager like 1Password."
        }
    else:
        response = {"permission": "allow"}

    print(json.dumps(response))
else:
    # ä¸æ˜¯æˆ‘ä»¬çš„ç›®æ ‡äº‹ä»¶ï¼Œå…è®¸
    print(json.dumps({"permission": "allow"}))
```

**æ­¥éª¤ 2: åœ¨ `.cursor/hooks.json` ä¸­é…ç½®**

```json
{
  "afterFileEdit": {
    "command": "python3",
    "args": ["hooks/detect_secrets.py"]
  }
}
```

**æ­¥éª¤ 3: ä½¿è„šæœ¬å¯æ‰§è¡Œ**

```bash
chmod +x hooks/detect_secrets.py
```

**ä¼šå‘ç”Ÿä»€ä¹ˆï¼š**
1. æ™ºèƒ½ä½“ä¿®æ”¹åŒ…å« `AKIAIOSFODNN7EXAMPLE` çš„æ–‡ä»¶
2. Hook æ£€æµ‹åˆ° AWS Key æ¨¡å¼
3. ç¼–è¾‘è¢«é˜»æ­¢ï¼Œå¹¶å‘ç”¨æˆ·æ˜¾ç¤ºæ¸…æ™°çš„æ¶ˆæ¯
4. æ™ºèƒ½ä½“æ”¶åˆ°å…³äºé˜»æ­¢çš„ä¸Šä¸‹æ–‡å¹¶å»ºè®®æ›¿ä»£æ–¹æ¡ˆ

### å®è·µç¤ºä¾‹ï¼šå¼ºåˆ¶ä»£ç å®¡æŸ¥

**ç›®æ ‡ï¼š** è¦æ±‚å¯¹å…³é”®æ–‡ä»¶çš„æ›´æ”¹è¿›è¡Œæ‰‹åŠ¨æ‰¹å‡†ã€‚

```python
#!/usr/bin/env python3
import json
import sys

event = json.load(sys.stdin)

if event.get("hook_event_name") == "afterFileEdit":
    file_path = event.get("file_path", "")

    # éœ€è¦å®¡æŸ¥çš„å…³é”®æ–‡ä»¶
    critical_patterns = [
        "production.config",
        "Dockerfile",
        "terraform/",
        ".github/workflows/"
    ]

    is_critical = any(pattern in file_path for pattern in critical_patterns)

    if is_critical:
        response = {
            "permission": "ask",
            "user_message": f"âš ï¸ This changes a critical file: {file_path}\n\nPlease review the changes carefully before approving."
        }
    else:
        response = {"permission": "allow"}

    print(json.dumps(response))
else:
    print(json.dumps({"permission": "allow"}))
```

**é…ç½®ï¼š**

```json
{
  "afterFileEdit": {
    "command": "python3",
    "args": ["hooks/critical_review.py"]
  }
}
```

**ç»“æœï¼š** ç”¨æˆ·å¿…é¡»æ˜ç¡®æ‰¹å‡†å¯¹å…³é”®åŸºç¡€è®¾æ–½æ–‡ä»¶çš„æ›´æ”¹ã€‚

### ä¼ä¸šåˆ†å‘

Cursor ç‹¬ç‰¹åœ°æ”¯æŒé›†ä¸­å¼ Hook åˆ†å‘ï¼š

**1. MDM éƒ¨ç½² (ç§»åŠ¨è®¾å¤‡ç®¡ç†):** 

é€šè¿‡ä¼ä¸šå·¥å…· (Jamf, Intune) éƒ¨ç½² Hooksï¼š

```bash
# å®‰è£…ä¼ä¸š hooks (macOS ç¤ºä¾‹)
sudo mkdir -p "/Library/Application Support/Cursor"
sudo cp hooks.json "/Library/Application Support/Cursor/hooks.json"
sudo chmod 644 "/Library/Application Support/Cursor/hooks.json"
```

**2. äº‘åˆ†å‘ (ä¼ä¸šç‰ˆè®¡åˆ’):** 

- ç®¡ç†å‘˜åœ¨ Cursor çš„ Web ä»ªè¡¨æ¿ä¸­é…ç½® Hooks
- Hooks è‡ªåŠ¨åŒæ­¥ç»™æ‰€æœ‰å›¢é˜Ÿæˆå‘˜
- åŒæ­¥é—´éš”ï¼šçº¦ 30 åˆ†é’Ÿ
- ç”¨æˆ·ä¸èƒ½è¦†ç›–ï¼ˆå¼ºåˆ¶å®‰å…¨ç­–ç•¥ï¼‰

**3. ç‰ˆæœ¬æ§åˆ¶:** 

æ²¡æœ‰ä¼ä¸šç‰ˆè®¡åˆ’çš„å›¢é˜Ÿçš„æ ‡å‡†æ–¹æ³•ï¼š

```bash
# å›¢é˜Ÿé€šè¿‡ Git å…±äº« hooks
git clone company/shared-cursor-hooks
ln -s "$(pwd)/shared-cursor-hooks/hooks.json" .cursor/hooks.json
```

### åˆä½œä¼™ä¼´ç”Ÿæ€ç³»ç»Ÿ

Cursor ä¸å®‰å…¨åˆä½œä¼™ä¼´æœ‰å®˜æ–¹é›†æˆï¼š

- **Semgrep:** ä»£ç å®‰å…¨æ‰«æ
- **Snyk:** æ¼æ´æ£€æµ‹
- **1Password:** æœºå¯†ç®¡ç†
- **Oasis Security:** AI å®‰å…¨ç­–ç•¥
- **Endor Labs:** ä¾›åº”é“¾å®‰å…¨

è¿™äº›ä¸ºå¸¸è§çš„å®‰å…¨å·¥ä½œæµæä¾›äº†é¢„æ„å»ºçš„ Hooksã€‚

### Cursor Hooks æ•…éšœæ’é™¤

**Hook è¿›ç¨‹å´©æºƒï¼š**
- éš”ç¦»æµ‹è¯•è„šæœ¬ï¼š`echo '{"hook_event_name": "test"}' | python3 your_hook.py`
- æ£€æŸ¥ Cursor æ—¥å¿—ï¼šHelp â†’ Developer â†’ Toggle Developer Tools
- ç¡®ä¿è„šæœ¬è¾“å‡ºæœ‰æ•ˆçš„ JSON

**æƒé™æ€»æ˜¯ "ask" å³ä½¿æœªè¿”å›ï¼š**
- æ£€æŸ¥ JSON å“åº”æ˜¯å¦æ ¼å¼é”™è¯¯
- éªŒè¯å“åº”æ˜¯å¦åŒ…å« "permission" å­—æ®µ
- ä½¿ç”¨æœ€å°å“åº”è¿›è¡Œæµ‹è¯•ï¼š`{"permission": "allow"}`

**ä¼ä¸š Hooks æœªåº”ç”¨ï¼š**
- éªŒè¯å®‰è£…è·¯å¾„ï¼ˆmacOS vs Windows vs Linux ä¸åŒï¼‰
- æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆhooks.json å¿…é¡»å¯è¯»ï¼‰
- ç­‰å¾…åŒæ­¥é—´éš”ï¼ˆäº‘åˆ†å‘çº¦ 30 åˆ†é’Ÿï¼‰

## è¯¦ç»†å®ç°æŒ‡å—ï¼šKiro

### é…ç½®ç»“æ„

Kiro ä½¿ç”¨åŸºäºç›®å½•çš„æ–¹æ³•ï¼š

```
/project/.kiro/hooks/
â”œâ”€â”€ test_sync.json
â”œâ”€â”€ doc_update.json
â””â”€â”€ format_on_save.json
```

æ¯ä¸ªæ–‡ä»¶ä½¿ç”¨è‡ªç„¶è¯­è¨€å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ª Hooksã€‚

### è§¦å‘ç±»å‹

Kiro ä¸“æ³¨äºåŸºäºæ–‡ä»¶çš„äº‹ä»¶ï¼š

| è§¦å‘å™¨ | è§¦å‘æ—¶æœº | ç¤ºä¾‹ç”¨ä¾‹ |
|---------|---------------|------------------|
| `fileEdit` | æ–‡ä»¶ä¿®æ”¹ | æ›´æ–°ç›¸å…³æ–‡ä»¶ï¼Œè¿è¡Œæ ¼å¼åŒ–å™¨ |
| `fileCreate` | æ–°æ–‡ä»¶åˆ›å»º | ç”Ÿæˆæ ·æ¿ä»£ç ï¼Œæ›´æ–°ç´¢å¼• |
| `fileDelete` | æ–‡ä»¶åˆ é™¤ | æ¸…ç†ç›¸å…³æ–‡ä»¶ï¼Œæ›´æ–°å¼•ç”¨ |
| `userTriggered` | æ‰‹åŠ¨æ¿€æ´» | é€šè¿‡ UI è¿›è¡ŒæŒ‰éœ€æ“ä½œ |

### è‡ªç„¶è¯­è¨€é…ç½®

Kiro çš„å…³é”®åˆ›æ–°ï¼š**Hooks å®šä¹‰ä¸ºè‡ªç„¶è¯­è¨€æç¤ºè¯**ï¼Œè€Œä¸æ˜¯è„šæœ¬ã€‚

```json
{
  "name": "Synchronize Tests",
  "trigger": {
    "type": "fileEdit",
    "pattern": "src/**/*.py"
  },
  "action": {
    "prompt": "A Python source file has been modified. Check if a corresponding test file exists in the tests/ directory with the same name prefixed by 'test_'. If it exists, analyze the changes and update the test file to cover any new functions or modified behavior. If no test file exists, create one with basic test cases for all public functions."
  }
}
```

**è¿™ä¸åŸºäºå‘½ä»¤çš„ Hooks æœ‰ä½•ä¸åŒï¼š**
- æ— éœ€è„šæœ¬
- AI ä½¿ç”¨å®Œæ•´çš„ä»£ç åº“ä¸Šä¸‹æ–‡è§£é‡Šæç¤ºè¯
- è‡ªç„¶è¯­è¨€æ›´æ˜“äºç¼–å†™å’Œç»´æŠ¤
- Kiro çš„ AI ç†è§£é¡¹ç›®ç»“æ„å’Œæƒ¯ä¾‹

### å®è·µç¤ºä¾‹ï¼šæ–‡æ¡£åŒæ­¥

**ç›®æ ‡ï¼š** å½“ TypeScript æ¥å£æ›´æ”¹æ—¶è‡ªåŠ¨æ›´æ–°æ–‡æ¡£ã€‚

**åˆ›å»º `.kiro/hooks/doc_sync.json`:**

```json
{
  "name": "API Documentation Sync",
  "trigger": {
    "type": "fileEdit",
    "pattern": "src/types/*.ts"
  },
  "action": {
    "prompt": "A TypeScript type definition file has been modified. Please:\n\n1. Identify any exported interfaces or types that changed\n2. Find the corresponding documentation file in docs/api/ (same base name with .md extension)\n3. Update the documentation to reflect:\n   - New properties added to interfaces\n   - Changed property types\n   - Modified JSDoc comments\n   - New interfaces or types\n4. Maintain the existing documentation structure and examples\n5. Add a note at the top: 'Last updated: [current date] (auto-synced from types)'\n\nIf no documentation file exists, create one with:\n- Interface/type name as heading\n- Description from JSDoc\n- Property table with types and descriptions\n- Usage example"
  }
}
```

**å‘ç”Ÿä»€ä¹ˆï¼š**
1. å¼€å‘è€…ç¼–è¾‘ `src/types/User.ts`
2. ä¿å­˜æ—¶è§¦å‘ Hook
3. Kiro çš„ AI è¯»å–æ›´æ”¹
4. AI ç†è§£è¦æ›´æ–° `docs/api/User.md`
5. æ–‡æ¡£è‡ªåŠ¨ä¿æŒåŒæ­¥

### å®è·µç¤ºä¾‹ï¼šç»„ä»¶æ¨¡æ¿

**ç›®æ ‡ï¼š** åˆ›å»º React ç»„ä»¶æ—¶è‡ªåŠ¨ç”Ÿæˆæ ·æ¿ä»£ç ã€‚

```json
{
  "name": "React Component Template",
  "trigger": {
    "type": "fileCreate",
    "pattern": "src/components/**/*.tsx"
  },
  "action": {
    "prompt": "A new React component file was created. Analyze the file name and directory structure, then:\n\n1. If the file is empty or only has basic imports, generate a complete component template:\n   - Extract component name from file name
   - Add TypeScript interface for props (ComponentNameProps)
   - Create functional component with proper typing
   - Add JSDoc comment describing the component
   - Include standard imports (React, any common hooks)
   - Add export statement\n\n2. Follow the project's existing component patterns (check other components in the same directory)\n\n3. If the component name suggests a specific pattern (e.g., 'Button', 'Modal', 'Form'), include relevant props and structure\n\n4. Add a TODO comment for the developer to implement the component logic"
  }
}
```

**ç»“æœï¼š** æ–°ç»„ä»¶æ–‡ä»¶ä¼šæ ¹æ®é¡¹ç›®æƒ¯ä¾‹è‡ªåŠ¨è·å¾—è„šæ‰‹æ¶ã€‚

### æ‰‹åŠ¨è§¦å‘å™¨

Kiro æ”¯æŒé€šè¿‡ UI ç”¨æˆ·æ¿€æ´» Hooksï¼š

```json
{
  "name": "Generate Comprehensive Tests",
  "trigger": {
    "type": "userTriggered"
  },
  "action": {
    "prompt": "Generate comprehensive unit tests for all public functions in the current file. Include:\n- Happy path tests\n- Edge cases\n- Error handling\n- Mock external dependencies\nPlace tests in the corresponding test file following project conventions."
  }
}
```

**ç”¨æ³•ï¼š** å³é”®å•å‡»æ–‡ä»¶ â†’ Run Hook â†’ "Generate Comprehensive Tests"

### é…ç½®æœ€ä½³å®è·µ

**1. æç¤ºè¯è¦å…·ä½“:** 

âŒ **å¤ªæ¨¡ç³Š:**
```json
{
  "prompt": "Update the tests"
}
```

âœ… **æ¸…æ™°ä¸”å¯æ“ä½œ:**
```json
{
  "prompt": "Analyze the modified Python file. For each new or changed function, add or update corresponding test cases in the test file. Ensure tests cover normal cases, edge cases, and error conditions. Use pytest conventions and existing test patterns."
}
```

**2. åŒ…å«å…³äºé¡¹ç›®æƒ¯ä¾‹çš„ä¸Šä¸‹æ–‡:** 

```json
{
  "prompt": "Generate API documentation following our project's conventions:\n- Use JSDoc format\n- Include @param and @returns tags\n- Add usage examples\n- Reference related endpoints\n- Follow the structure in existing docs/api/ files"
}
```

**3. ä½¿ç”¨æ¨¡å¼é’ˆå¯¹ç‰¹å®šæ–‡ä»¶:** 

```json
{
  "trigger": {
    "type": "fileEdit",
    "pattern": "src/**/*.{ts,tsx}"
  }
}
```

### é™åˆ¶å’Œæ³¨æ„äº‹é¡¹

**Kiro Hooks å¾ˆå¼ºå¤§ä½†æœ‰æ‰€ä¸åŒï¼š**

- **æ‰§è¡Œæ—¶é—´ï¼š** AI è§£é‡Šæ¯” shell è„šæœ¬æ…¢
- **ç¡®å®šæ€§ï¼š** è‡ªç„¶è¯­è¨€è§£é‡Šå¯èƒ½ä¼šæœ‰è½»å¾®å˜åŒ–
- **è°ƒè¯•ï¼š** æ¯”æ˜¾å¼è„šæœ¬æ›´éš¾è°ƒè¯•
- **æœ€é€‚åˆï¼š** éœ€è¦ç†è§£ä»£ç çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥ä»»åŠ¡
- **ä¸é€‚åˆï¼š** ç®€å•çš„æ ¼å¼åŒ–ä»»åŠ¡ï¼ˆå¯¹æ­¤ä½¿ç”¨åŸºäºå‘½ä»¤çš„ Hooksï¼‰

### Kiro Hooks æ•…éšœæ’é™¤

**Hook æœªè§¦å‘ï¼š**
- æ£€æŸ¥æ–‡ä»¶æ¨¡å¼åŒ¹é…ï¼ˆä½¿ç”¨ glob æµ‹è¯•å™¨æµ‹è¯•ï¼‰
- éªŒè¯ JSON è¯­æ³•
- ç¡®ä¿ `.kiro/hooks/` ç›®å½•å­˜åœ¨ä¸”æ–‡ä»¶å…·æœ‰ `.json` æ‰©å±•å

**æ„å¤–è¡Œä¸ºï¼š**
- ä½¿æç¤ºè¯æ›´æ˜ç¡®å’Œè¯¦ç»†
- å¼•ç”¨ç‰¹å®šçš„é¡¹ç›®æƒ¯ä¾‹
- é€šè¿‡è¦æ±‚ Kiro æ‰§è¡Œä»»åŠ¡æ¥æ‰‹åŠ¨æµ‹è¯•æç¤ºè¯
- æ£€æŸ¥ AI æ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ï¼ˆå¯èƒ½éœ€è¦æ‰“å¼€ç›¸å…³æ–‡ä»¶ï¼‰

**æ€§èƒ½é—®é¢˜ï¼š**
- å‡å°‘ Hook é¢‘ç‡ï¼ˆé¿å…åœ¨æ¯æ¬¡æŒ‰é”®æ—¶è§¦å‘ï¼‰
- ç®€åŒ–å¤æ‚çš„æç¤ºè¯
- è€ƒè™‘å¯¹ç®€å•ä»»åŠ¡ä½¿ç”¨åŸºäºå‘½ä»¤çš„ Hooks

## è·¨æ‰€æœ‰å®ç°çš„é€šç”¨æ¨¡å¼

å°½ç®¡è¯­æ³•ä¸åŒï¼Œè¿™äº›æ¨¡å¼é€šç”¨ï¼š

### æ¨¡å¼ 1: ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–

**ç›®æ ‡ï¼š** ç¡®ä¿ä»£ç é£æ ¼ä¸€è‡´æ€§ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

**Claude Code:**
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [{"type": "command", "command": "prettier --write {{file_path}}"}]
      }
    ]
  }
}
```

**Cursor:**
```json
{
  "afterFileEdit": {
    "command": "prettier",
    "args": ["--write", "{{file_path}}"]
  }
}
```

**Kiro:**
```json
{
  "trigger": {"type": "fileEdit"},
  "action": {"prompt": "Format the modified file using Prettier with project settings"}
}
```

### æ¨¡å¼ 2: é˜»æ­¢å±é™©æ“ä½œ

**ç›®æ ‡ï¼š** é˜²æ­¢æ„å¤–æ•°æ®ä¸¢å¤±æˆ–å®‰å…¨é—®é¢˜ã€‚

**Claude Code:**
```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{"type": "prompt", "prompt": "If this command contains 'rm -rf' or modifies system files, respond DENY with explanation. Otherwise ALLOW."}]
      }
    ]
  }
}
```

**Cursor:**
```python
# Hook è„šæœ¬ä¸­
if "rm -rf" in event.get("command", ""):
    print(json.dumps({
        "permission": "deny",
        "user_message": "Blocked: Recursive deletion detected"
    }))
```

**Kiro:**
```json
{
  "trigger": {"type": "fileDelete", "pattern": "**/*.{json,config,env}"},
  "action": {"prompt": "Critical file deletion detected. Alert the user and require explicit confirmation before proceeding."}
}
```

### æ¨¡å¼ 3: æµ‹è¯•åŒæ­¥

**ç›®æ ‡ï¼š** å½“å®ç°ä»£ç æ›´æ”¹æ—¶ä¿æŒæµ‹è¯•æ›´æ–°ã€‚

**Claude Code:**
```bash
#!/bin/bash
# Hook è„šæœ¬
FILE_PATH=$(echo "$EVENT_DATA" | jq -r '.tool_input.file_path')
if [[ "$FILE_PATH" == src/*.py ]]; then
  TEST_FILE="tests/test_$(basename $FILE_PATH)"
  # ä½¿ç”¨ Claude æ›´æ–°æµ‹è¯•
  claude-cli "Update $TEST_FILE to cover changes in $FILE_PATH"
fi
```

**Cursor:**
```python
# Hook è„šæœ¬
if event["hook_event_name"] == "afterFileEdit":
    src_file = event["file_path"]
    if src_file.startswith("src/"):
        test_file = src_file.replace("src/", "tests/test_")
        print(json.dumps({
            "permission": "allow",
            "agent_message": f"Also update {test_file} to cover changes in {src_file}"
        }))
```

**Kiro:**
```json
{
  "trigger": {"type": "fileEdit", "pattern": "src/**/*.ts"},
  "action": {"prompt": "Source file modified. Find the corresponding test file (in tests/ with same name) and update tests to cover any new or modified functions."}
}
```

### æ¨¡å¼ 4: å®Œæˆé€šçŸ¥

**ç›®æ ‡ï¼š** æ™ºèƒ½ä½“é•¿æ—¶é—´è¿è¡Œä»»åŠ¡å®Œæˆæ—¶ä¿æŒé€šçŸ¥ã€‚

**Claude Code:**
```json
{
  "hooks": {
    "Stop": [
      {
        "hooks": [{"type": "command", "command": "osascript -e 'display notification \"Task complete\" with title \"Claude Code\"'"}]
      }
    ]
  }
}
```

**Cursor:**
```bash
# "stop" äº‹ä»¶çš„ Hook è„šæœ¬
curl -X POST https://hooks.slack.com/...
  -d "{\"text\": \"Agent session completed: $(date)\"}"
```

**Kiro:**
*(Kiro æ²¡æœ‰ä¼šè¯çº§ Hooksï¼Œä½†å¯ä»¥åœ¨æ–‡ä»¶æ“ä½œæ—¶é€šçŸ¥)*

```json
{
  "trigger": {"type": "userTriggered"},
  "action": {"prompt": "Send a summary of changes made in this session to the #dev-ai channel in Slack using the MCP Slack tool"}
}
```

### æ¨¡å¼ 5: ä¸Šä¸‹æ–‡æ³¨å…¥

**ç›®æ ‡ï¼š** åœ¨ AI å¤„ç†è¯·æ±‚ä¹‹å‰æ·»åŠ ç›¸å…³ä¿¡æ¯ã€‚

**Claude Code:**
```json
{
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [{"type": "command", "command": "echo 'Additional context: Current sprint focus is performance optimization. Prioritize O(n) solutions.'"}]
      }
    ]
  }
}
```

**Cursor:**
```python
if event["hook_event_name"] == "beforeSubmitPrompt":
    with open(".project-context.md") as f:
        context = f.read()
    print(json.dumps({
        "permission": "allow",
        "agent_message": f"Project context:\n{context}"
    }))
```

**Kiro:**
*(ä¸Šä¸‹æ–‡æ³¨å…¥å†…ç½®äº Kiro çš„ AI ä¸­â€”â€”Hooks é€šå¸¸ä¸“æ³¨äºæ“ä½œ)*

## å®‰å…¨æœ€ä½³å®è·µ

Hooks æ‹¥æœ‰å¼ºå¤§çš„åŠ›é‡ã€‚éµå¾ªè¿™äº›å‡†åˆ™ä»¥å®‰å…¨ä½¿ç”¨ï¼š

### 1. æœ€å°æƒé™åŸåˆ™

ä»…æˆäºˆ Hooks å¿…è¦çš„æƒé™ï¼š

```bash
# Good: ç‰¹å®šå·¥å…·åŒ¹é…å™¨
"matcher": "Edit"

# Risky: åŒ¹é…æ‰€æœ‰å·¥å…·
"matcher": ".*"
```

### 2. è¾“å…¥éªŒè¯

åœ¨è¡ŒåŠ¨ä¹‹å‰å§‹ç»ˆéªŒè¯äº‹ä»¶æ•°æ®ï¼š

```python
# Bad: ç›²ç›®ä¿¡ä»»è¾“å…¥
file_path = event["file_path"]
os.system(f"cat {file_path}")  # Shell æ³¨å…¥é£é™©ï¼

# Good: éªŒè¯å’Œè½¬ä¹‰
import shlex
file_path = event.get("file_path", "")
if file_path and os.path.exists(file_path):
    subprocess.run(["cat", file_path])  # å®‰å…¨
```

### 3. æœºå¯†ç®¡ç†

æ°¸è¿œä¸è¦åœ¨ Hooks ä¸­ç¡¬ç¼–ç å‡­æ®ï¼š

```bash
# Bad
curl -H "Authorization: Bearer sk_live_abc123..." https://api.example.com

# Good
curl -H "Authorization: Bearer $API_KEY" https://api.example.com
```

å°†æœºå¯†å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡æˆ–ä½¿ç”¨æœºå¯†ç®¡ç†å™¨ (1Password, AWS Secrets Manager)ã€‚

### 4. å®¡è®¡æ—¥å¿—

è®°å½• Hook æ‰§è¡Œä»¥ç¬¦åˆè§„è§„ï¼š

```python
import logging
logging.basicConfig(filename='/var/log/hooks.log', level=logging.INFO)

def hook_handler(event):
    logging.info(f"Hook fired: {event['hook_event_name']} by {event.get('user_email')}")
    # ... hook é€»è¾‘
```

### 5. é”™è¯¯å¤„ç†

å®‰å…¨å¤±è´¥ï¼š

```python
try:
    result = dangerous_operation()
    response = {"permission": "allow"}
except Exception as e:
    # å¤±è´¥å…³é—­ï¼šé”™è¯¯æ—¶æ‹’ç»
    response = {
        "permission": "deny",
        "user_message": "Hook error: operation blocked for safety"
    }
    logging.error(f"Hook error: {e}")

print(json.dumps(response))
```

### 6. Hooks çš„ä»£ç å®¡æŸ¥

å°† Hooks è§†ä¸ºç”Ÿäº§ä»£ç ï¼š
- åœ¨ PR ä¸­å®¡æŸ¥æ‰€æœ‰ Hook æ›´æ”¹
- åœ¨æš‚å­˜ç¯å¢ƒä¸­æµ‹è¯• Hooks
- è®°å½•é¢„æœŸè¡Œä¸º
- ç‰ˆæœ¬æ§åˆ¶æ‰€æœ‰ Hook é…ç½®

### 7. èŒƒå›´é™åˆ¶

å°†é¡¹ç›®çº§ Hooks ç”¨äºç‰¹å®šé¡¹ç›®çš„è§„åˆ™ï¼š

```
# ç”¨æˆ·çº§ (~/.cursor/hooks.json)
- ä¸ªäººåå¥½ï¼ˆé€šçŸ¥æ ·å¼ï¼Œæ—¥å¿—è®°å½•ï¼‰
- éå®‰å…¨å…³é”®çš„æ ¼å¼åŒ–ç¨‹åº

# é¡¹ç›®çº§ (.cursor/hooks.json)
- å®‰å…¨ç­–ç•¥
- ä»£ç è´¨é‡é—¨æ§
- å›¢é˜Ÿæ ‡å‡†

# ä¼ä¸šçº§ (MDM/äº‘)
- å…¬å¸èŒƒå›´çš„å®‰å…¨ç­–ç•¥
- åˆè§„è¦æ±‚
- é›†ä¸­ç®¡ç†çš„è§„åˆ™
```

## é€‰æ‹©æ­£ç¡®çš„ Hook ç­–ç•¥

ä½¿ç”¨æ­¤å†³ç­–æ ‘é€‰æ‹©åˆé€‚çš„å®ç°ï¼š

```
ä½ æ˜¯å¦ä½¿ç”¨å¤šä¸ª AI ç¼–ç å·¥å…·ï¼Ÿ
â”œâ”€ æ˜¯ â†’ åœ¨æ¯ä¸ªå·¥å…·çš„æ ¼å¼ä¸­å®ç°ç±»ä¼¼çš„ Hooks
â””â”€ å¦ â†’ ä½¿ç”¨ä½ å·¥å…·çš„åŸç”Ÿ Hook ç³»ç»Ÿ

ä½ çš„ä»»åŠ¡éœ€è¦ç†è§£ä»£ç è¯­ä¹‰å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ Claude Code (prompt æ¨¡å¼) æˆ– Kiro (è‡ªç„¶è¯­è¨€)
â””â”€ å¦ â†’ ä»»ä½•å®ç° (command æ¨¡å¼æœ€å¿«)

ä½ éœ€è¦ä¼ä¸šèŒƒå›´çš„å¼ºåˆ¶æ‰§è¡Œå—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ Cursor (MDM/äº‘åˆ†å‘)
â””â”€ å¦ â†’ é¡¹ç›®çº§ Hooks (ç‰ˆæœ¬æ§åˆ¶)

ä»»åŠ¡æ˜¯å¦ç®€å•ä¸”ç¡®å®šï¼Ÿ(æ ¼å¼åŒ–, lint, è¿è¡Œæµ‹è¯•)
â”œâ”€ æ˜¯ â†’ åŸºäºå‘½ä»¤çš„ Hooks (Claude Code, Cursor)
â””â”€ å¦ â†’ åŸºäºæç¤ºè¯çš„ Hooks (Claude Code) æˆ– Kiro

ä½ æœ‰ç°æœ‰çš„ shell è„šæœ¬/å·¥å…·å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ Claude Code æˆ– Cursor (å¯ä»¥ç›´æ¥è°ƒç”¨è„šæœ¬)
â””â”€ å¦ â†’ Kiro (è‡ªç„¶è¯­è¨€æ›´æ˜“äºç¼–å†™)
```

### æ··åˆæ–¹æ³•

ä½ å¯ä»¥ç»“åˆå®ç°ï¼š

**ç¤ºä¾‹ï¼šå¤šå·¥å…·é¡¹ç›®**

```
# Claude Code (.claude/settings.json)
- PostToolUse: ä½¿ç”¨ Black è‡ªåŠ¨æ ¼å¼åŒ–
- PreToolUse: é˜»æ­¢å±é™©å‘½ä»¤

# Cursor (.cursor/hooks.json)
- afterFileEdit: æœºå¯†æ£€æµ‹
- beforeShellExecution: å®‰å…¨éªŒè¯

# Kiro (.kiro/hooks/)
- æµ‹è¯•åŒæ­¥ (éœ€è¦ä»£ç ç†è§£)
- æ–‡æ¡£æ›´æ–° (åˆ©ç”¨ AI ä¸Šä¸‹æ–‡)
```

æ¯ä¸ªå·¥å…·å¤„ç†å®ƒæœ€æ“…é•¿çš„äº‹æƒ…ã€‚

## é«˜çº§ç”¨ä¾‹

### ç”¨ä¾‹ 1: è‡ªåŠ¨ä»£ç å®¡æŸ¥

**ç›®æ ‡ï¼š** AI é©±åŠ¨çš„é¢„æäº¤å®¡æŸ¥ï¼Œæ£€æŸ¥å¸¸è§é—®é¢˜ã€‚

**å®ç° (Cursor):**

```python
#!/usr/bin/env python3
import json
import sys
import subprocess

event = json.load(sys.stdin)

if event.get("hook_event_name") == "afterFileEdit":
    file_path = event["file_path"]
    file_content = event["file_content"]

    # ä½¿ç”¨ LLM å®¡æŸ¥ä»£ç 
    review_prompt = f"""Review this code change for:
    1. Potential bugs
    2. Performance issues
    3. Security vulnerabilities
    4. Best practice violations

    File: {file_path}

    Code:
    {file_content}

    Provide brief feedback or \"LGTM\" if no issues found."""

    # é€šè¿‡ API æˆ– MCP è°ƒç”¨ LLM
    review_result = call_llm(review_prompt)

    if "LGTM" not in review_result:
        response = {
            "permission": "ask",
            "user_message": f"Code review feedback:\n{review_result}\n\nProceed anyway?"
        }
    else:
        response = {"permission": "allow"}

    print(json.dumps(response))
```

### ç”¨ä¾‹ 2: åˆè§„æ–‡æ¡£

**ç›®æ ‡ï¼š** ä¸ºå—ç›‘ç®¡ç¯å¢ƒè‡ªåŠ¨ç”Ÿæˆåˆè§„æ–‡æ¡£ã€‚

**å®ç° (Kiro):**

```json
{
  "name": "HIPAA Compliance Documentation",
  "trigger": {
    "type": "fileEdit",
    "pattern": "src/models/**/*.py"
  },
  "action": {
    "prompt": "A data model file was modified. Check if it handles PHI (Protected Health Information) by looking for fields like patient names, SSNs, medical records, etc. If PHI is present:\n\n1. Update docs/compliance/data-models.md with:\n   - Model name and purpose\n   - PHI fields identified\n   - Encryption methods used\n   - Access controls required\n   - Audit logging status\n\n2. Verify the model includes:\n   - Field-level encryption for PHI\n   - Audit trail fields (created_at, modified_by)\n   - Access control decorators\n\n3. If any compliance requirements are missing, alert the developer with specific gaps and remediation steps."
  }
}
```

### ç”¨ä¾‹ 3: å¤šé˜¶æ®µæ‰¹å‡†å·¥ä½œæµ

**ç›®æ ‡ï¼š** è¦æ±‚å¯¹å…³é”®æ›´æ”¹è¿›è¡Œå¤šæ¬¡æ‰¹å‡†ã€‚

**å®ç° (Cursor):**

```python
#!/usr/bin/env python3
import json
import sys
import os

APPROVAL_FILE = "/tmp/pending_approvals.json"

event = json.load(sys.stdin)

if event.get("hook_event_name") == "afterFileEdit":
    file_path = event["file_path"]

    # éœ€è¦ä¸¤æ¬¡æ‰¹å‡†çš„å…³é”®è·¯å¾„
    critical_paths = ["src/billing/", "src/auth/", "database/migrations/"]

    if any(cp in file_path for cp in critical_paths):
        # åŠ è½½ç°æœ‰æ‰¹å‡†
        approvals = {}
        if os.path.exists(APPROVAL_FILE):
            with open(APPROVAL_FILE) as f:
                approvals = json.load(f)

        file_key = file_path
        current_count = approvals.get(file_key, 0)

        if current_count < 1:
            # éœ€è¦ç¬¬ä¸€æ¬¡æ‰¹å‡†
            approvals[file_key] = current_count + 1
            with open(APPROVAL_FILE, "w") as f:
                json.dump(approvals, f)

            response = {
                "permission": "ask",
                "user_message": f"Critical file change (1/2 approvals): {file_path}\n\nFirst approval required."
            }
        else:
            # ç¬¬äºŒæ¬¡æ‰¹å‡†å·²æˆäºˆï¼Œæ¸…é™¤çŠ¶æ€
            approvals.pop(file_key, None)
            with open(APPROVAL_FILE, "w") as f:
                json.dump(approvals, f)

            response = {
                "permission": "allow",
                "user_message": "âœ“ Second approval granted. Change allowed."
            }

        print(json.dumps(response))
    else:
        print(json.dumps({"permission": "allow"}))
```

### ç”¨ä¾‹ 4: ä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆ

**ç›®æ ‡ï¼š** ä»£ç æ›´æ”¹æ—¶æ›´æ–°é¡¹ç›®ç®¡ç†å·¥å…·ã€‚

**å®ç° (Claude Code):**

```bash
#!/bin/bash
# Hook: ç¼–è¾‘æ–‡ä»¶æ—¶æ›´æ–° Jira

EVENT_DATA=$(cat)
FILE_PATH=$(echo "$EVENT_DATA" | jq -r '.tool_input.file_path // empty')

# ä»åˆ†æ”¯åç§°æå– Jira ticket
BRANCH=$(git rev-parse --abbrev-ref HEAD)
TICKET=$(echo "$BRANCH" | grep -oE '[A-Z]+-[0-9]+')

if [ -n "$TICKET" ]; then
  # é€šè¿‡ API æ›´æ–° Jira
  curl -X POST "https://your-domain.atlassian.net/rest/api/3/issue/$TICKET/comment" \
    -H "Authorization: Bearer $JIRA_API_TOKEN" \
    -H "Content-Type: application/json" \
    -d "{\"body\": {\"type\": \"doc\", \"version\": 1, \"content\": [{\"type\": \"paragraph\", \"content\": [{\"type\": \"text\", \"text\": \"AI agent modified: $FILE_PATH\"}]}]}"

  echo '{"permission": "allow", "message": "Updated Jira ticket '$TICKET'"}'
else
  echo '{"permission": "allow"}'
fi
```

## æ•…éšœæ’é™¤ä¸æç¤º

### é€šç”¨è°ƒè¯•æ­¥éª¤

**1. éš”ç¦»æµ‹è¯• Hooksï¼š**
```bash
# åˆ›å»ºæœ€å°æµ‹è¯•äº‹ä»¶
echo '{"hook_event_name": "test", "file_path": "/tmp/test.py"}' | python3 your_hook.py
```

**2. å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š**
```python
import sys
import logging
logging.basicConfig(stream=sys.stderr, level=logging.DEBUG)
logging.debug(f"Hook received event: {event}")
```

**3. éªŒè¯ JSON è¾“å‡ºï¼š**
```bash
# æµ‹è¯• Hook è¾“å‡ºæœ‰æ•ˆ JSON
./your_hook.sh | jq .
```

### å¸¸è§é™·é˜±

**é™·é˜± 1: åœ¨ PostToolUse æœŸé—´ä¿®æ”¹æ–‡ä»¶**

```bash
# è¿™å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ï¼
# Hook åœ¨ Edit æ—¶è§¦å‘ â†’ Hook ä¿®æ”¹æ–‡ä»¶ â†’ å†æ¬¡è§¦å‘ Hook â†’ ...

# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ›´æ”¹æ˜¯å¦ç”± Hook è¿›è¡Œ
if [[ "$TOOL_OUTPUT" != *"by hook"* ]]; then
  # è¿›è¡Œä¿®æ”¹
fi
```

**é™·é˜± 2: å‡è®¾äº‹ä»¶ç»“æ„**

```python
# Bad: å‡è®¾å­—æ®µå­˜åœ¨
file_path = event["file_path"]  # å¦‚æœç¼ºå¤±ä¼š KeyError!

# Good: ä½¿ç”¨é»˜è®¤å€¼å®‰å…¨è®¿é—®
file_path = event.get("file_path", "")
if not file_path:
    print(json.dumps({"permission": "allow"}))
    sys.exit(0)
```

**é™·é˜± 3: ç¼“æ…¢çš„ Hook æ‰§è¡Œ**

```bash
# Bad: åŒæ­¥æ“ä½œé˜»å¡æ™ºèƒ½ä½“
sleep 30  # ç”¨æˆ·ç­‰å¾… 30 ç§’ï¼

# Good: åå°è¿è¡Œ
operation_in_background &
echo '{"permission": "allow", "message": "Started background task"}'
```

**é™·é˜± 4: æœªå¤„ç†é”™è¯¯**

```python
# Bad: æœªå¤„ç†çš„å¼‚å¸¸ä½¿ Hook å´©æºƒ
result = risky_operation()

# Good: ä¼˜é›…é™çº§
try:
    result = risky_operation()
    response = {"permission": "allow"}
except Exception as e:
    logging.error(f"Hook error: {e}")
    response = {"permission": "allow"}  # éå…³é”® Hooks å¤±è´¥å¼€æ”¾ (Fail open)
finally:
    print(json.dumps(response))
```

### æ€§èƒ½æç¤º

**1. ä½¿ç”¨ matchers é™åˆ¶ Hook è°ƒç”¨ï¼š**
```json
{
  "matcher": "Edit",
  "hooks": [...] 
}
```

**2. ä¸ç›¸å…³äº‹ä»¶å°½æ—©é€€å‡ºï¼š**
```python
# å…ˆæ£€æŸ¥æ¡ä»¶ï¼Œå°½æ—©é€€å‡º
if not file_path.endswith(".py"):
    print(json.dumps({"permission": "allow"}))
    sys.exit(0)

# ä»…åœ¨éœ€è¦æ—¶è¿›è¡Œæ˜‚è´µå¤„ç†
run_expensive_check(file_path)
```

**3. ç¼“å­˜æ˜‚è´µæ“ä½œï¼š**
```python
import functools

@functools.lru_cache(maxsize=128)
def expensive_validation(file_content_hash):
    # æ¯ä¸ªå”¯ä¸€å†…å®¹ä»…è¿è¡Œä¸€æ¬¡
    return validate(file_content_hash)
```

## æ€»ç»“å’Œåç»­æ­¥éª¤

### å…³é”®è¦ç‚¹

1. **Hooks æ˜¯ä¸€ç§æ¨¡å¼ï¼Œä¸æ˜¯æ ‡å‡†** - æ¯ä¸ªå·¥å…·å®ç°ä¸åŒ
2. **äº‹ä»¶é©±åŠ¨æ§åˆ¶** - åœ¨æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šç‚¹æ’å…¥é€»è¾‘
3. **æƒé™æ¨¡å‹** - å…è®¸ã€æ‹’ç»æˆ–è¯·æ±‚ç”¨æˆ·ç¡®è®¤
4. **é€‰æ‹©æ­£ç¡®çš„å·¥å…·** - Command æ¨¡å¼ä¸ºäº†é€Ÿåº¦ï¼ŒPrompt æ¨¡å¼ä¸ºäº†ä¸Šä¸‹æ–‡
5. **å®‰å…¨ä¼˜å…ˆ** - éªŒè¯è¾“å…¥ï¼Œå®‰å…¨å¤±è´¥ï¼Œå®¡è®¡æ“ä½œ
6. **ä»ç®€å•å¼€å§‹** - ä»è‡ªåŠ¨æ ¼å¼åŒ–å¼€å§‹ï¼Œæ‰©å±•åˆ°å¤æ‚å·¥ä½œæµ

### ä½ ç°åœ¨å¯ä»¥æ„å»ºä»€ä¹ˆ

ä½¿ç”¨ Hooksï¼Œä½ å¯ä»¥åˆ›å»ºï¼š
- **è´¨é‡é—¨æ§ï¼š** æäº¤å‰è‡ªåŠ¨æ ¼å¼åŒ–ã€lintã€æµ‹è¯•
- **å®‰å…¨ç­–ç•¥ï¼š** é˜»æ­¢æœºå¯†ã€å±é™©å‘½ä»¤ã€æœªç»æ‰¹å‡†çš„æ“ä½œ
- **å·¥ä½œæµè‡ªåŠ¨åŒ–ï¼š** æ›´æ–°æ–‡æ¡£ã€åŒæ­¥æµ‹è¯•ã€é€šçŸ¥åˆ©ç›Šç›¸å…³è€…
- **åˆè§„ç³»ç»Ÿï¼š** å®¡è®¡è·Ÿè¸ªã€æ‰¹å‡†å·¥ä½œæµã€æ–‡æ¡£
- **è‡ªå®šä¹‰é›†æˆï¼š** å°†æ™ºèƒ½ä½“è¿æ¥åˆ°ç°æœ‰çš„å·¥å…·å’Œæµç¨‹

### ä¸‹ä¸€æ­¥

**1. ä»ç®€å•çš„ Hook å¼€å§‹ï¼š**

ä»è¿™äº›é€‚åˆåˆå­¦è€…çš„ç¤ºä¾‹ä¸­é€‰æ‹©ä¸€ä¸ªï¼š
- ä½¿ç”¨ Prettier æˆ– Black è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
- å½“æ™ºèƒ½ä½“åœæ­¢æ—¶å‘é€ Slack é€šçŸ¥
- é˜»æ­¢ `rm -rf` å‘½ä»¤

**2. æ¢ç´¢ä½ çš„å·¥å…·åŠŸèƒ½ï¼š**

- **Claude Code ç”¨æˆ·ï¼š** é˜…è¯» `.claude/settings.json` æ¨¡å¼æ–‡æ¡£
- **Cursor ç”¨æˆ·ï¼š** æŸ¥çœ‹åˆä½œä¼™ä¼´é›†æˆ (Semgrep, Snyk ç­‰)
- **Kiro ç”¨æˆ·ï¼š** å°è¯•è‡ªç„¶è¯­è¨€æç¤ºè¯

**3. ä¸å›¢é˜Ÿåˆ†äº«ï¼š**

- å°† Hooks æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- è®°å½•æ¯ä¸ª Hook çš„ä½œç”¨
- åˆ›å»ºå¸¸è§æ¨¡å¼çš„å›¢é˜Ÿè¿è¡Œæ‰‹å†Œ

**4. åŠ å…¥ç¤¾åŒºï¼š**

- åˆ†äº«ä½ çš„ Hook å®ç°
- å­¦ä¹ ä»–äººçš„è§£å†³æ–¹æ¡ˆ
- è´¡çŒ® Hook åº“å’Œç¤ºä¾‹

### é¢å¤–èµ„æº

**å®˜æ–¹æ–‡æ¡£ï¼š**
- Claude Code: è®¾ç½®å’Œ Hooks å‚è€ƒ
- Cursor: Hooks API æ–‡æ¡£
- Kiro: Hook é…ç½®æŒ‡å—

**ç¤ºä¾‹ä»“åº“ï¼š**
- å„ç§å·¥å…·çš„ç¤¾åŒº Hook ç¤ºä¾‹
- ä»¥å®‰å…¨ä¸ºé‡ç‚¹çš„å®ç°
- å·¥ä½œæµè‡ªåŠ¨åŒ–æ¨¡å¼

**å®‰å…¨èµ„æºï¼š**
- OWASP AI å®‰å…¨æŒ‡å—
- æœºå¯†æ‰«ææ¨¡å¼ (TruffleHog, detect-secrets)
- åˆè§„æ–‡æ¡£æ¨¡æ¿

---

**è®°ä½ï¼š** Hooks å°† AI æ™ºèƒ½ä½“ä»å¼ºå¤§çš„å·¥å…·è½¬å˜ä¸ºå¼€å‘å·¥ä½œæµä¸­å¯æ§ã€å¯è§‚å¯Ÿå’Œå¯æ‰©å±•çš„æˆå‘˜ã€‚ä»å°å¤„ç€æ‰‹ï¼Œæ ¹æ®å›¢é˜Ÿéœ€æ±‚è¿­ä»£ï¼Œé€æ­¥æ„å»ºå¥å£®çš„ Hook ç”Ÿæ€ç³»ç»Ÿï¼Œä½¿ AI æ™ºèƒ½ä½“æ›´å®‰å…¨ã€æ›´é«˜æ•ˆã€‚

**æœ‰é—®é¢˜æˆ–åé¦ˆï¼Ÿ** ä¸ºæœ¬æ–‡æ¡£è´¡çŒ®æ”¹è¿›æˆ–ä¸ç¤¾åŒºåˆ†äº«ä½ çš„ Hook å®ç°ã€‚