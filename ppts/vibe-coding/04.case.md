---
layout: section
---

# 实例与案例（JavaScript）

---


## 案例 A：修复 Bug

**目标**：定位逻辑错误并给出补丁

**问题代码** `examples/04.case-bug.js`：

```javascript
function sumArray(arr) {
  // 预期：计算数组所有数字之和
  return arr.reduce((a, b) => a + b, 0);
}

// Bug：传入 undefined 时会抛出
sumArray(undefined); // TypeError!
```

**发给 AI 的 Prompt**：

```
测试失败，错误为 TypeError: Cannot read
properties of undefined (reading 'reduce')
请定位可能原因并给出修复补丁。
```

::right::

<div style="padding-left: 20px;">

**AI 修复建议**：

```javascript
function sumArray(arr) {
  // 防御性检查
  if (!Array.isArray(arr)) {
    return 0;
  }
  return arr.reduce((a, b) => a + b, 0);
}
```

**验证步骤**：

1. ✅ 运行原有测试
2. ✅ 添加边界测试用例
3. ✅ 人工复查代码

</div>

---

## 案例 B：自动生成单元测试

**目标**：为核心函数生成 Jest 测试

**原始函数**：

```javascript
function capitalizeWords(str) {
  return str.split(' ')
    .map(s => s.charAt(0).toUpperCase() 
           + s.slice(1))
    .join(' ');
}
```

**发给 AI 的 Prompt**：

```
为下列函数生成 Jest 测试用例，
覆盖正常输入、异常输入与边界条件。

代码：<粘贴上述函数>
```

::right::

<div style="padding-left: 20px;">

**AI 生成的测试**：

```javascript
const { capitalizeWords } = 
  require('./04.case-refactor');

test('正常字符串', () => {
  expect(capitalizeWords('hello world'))
    .toBe('Hello World');
});

test('空字符串', () => {
  expect(capitalizeWords('')).toBe('');
});

test('单词首字母已大写', () => {
  expect(capitalizeWords('Hello'))
    .toBe('Hello');
});

test('多空格分隔', () => {
  expect(capitalizeWords('a  b'))
    .toBe('A  B');
});
```

</div>

---

## 案例 C：重构建议

**目标**：将重复代码抽象为工具函数

**原始代码**（存在重复）：

```javascript
// file1.js
function formatUserName(user) {
  const name = user.name.split(' ')
    .map(s => s.charAt(0).toUpperCase() 
           + s.slice(1))
    .join(' ');
  return name;
}

// file2.js - 相同逻辑重复
function formatTitle(title) {
  return title.split(' ')
    .map(s => s.charAt(0).toUpperCase() 
           + s.slice(1))
    .join(' ');
}
```

::right::

<div style="padding-left: 20px;">

**AI 重构建议**：

```javascript
// utils.js - 提取公共函数
function capitalizeWords(str) {
  if (!str) return '';
  return str.split(' ')
    .map(s => s.charAt(0).toUpperCase() 
           + s.slice(1))
    .join(' ');
}

// file1.js
const { capitalizeWords } = require('./utils');
function formatUserName(user) {
  return capitalizeWords(user.name);
}

// file2.js
const { capitalizeWords } = require('./utils');
function formatTitle(title) {
  return capitalizeWords(title);
}
```

**改进点**：消除重复、统一维护、便于测试

</div>

---

# 操作流程示意

<div style="display: flex; justify-content: center; margin-top: 40px;">

<div style="display: flex; flex-direction: column; gap: 20px; max-width: 600px;">

<div style="display: flex; align-items: center; gap: 16px;">
<div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">1</div>
<div style="flex: 1; padding: 12px 16px; background: #f5f5f5; border-radius: 8px;">
<strong>贴出最小可复现代码片段</strong>
<div style="font-size: 12px; color: #666;">避免过多无关代码，聚焦问题本身</div>
</div>
</div>

<div style="display: flex; align-items: center; gap: 16px;">
<div style="width: 50px; height: 50px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">2</div>
<div style="flex: 1; padding: 12px 16px; background: #f5f5f5; border-radius: 8px;">
<strong>发送 Prompt 并让 AI 给出候选方案</strong>
<div style="font-size: 12px; color: #666;">可能需要 2-3 次交互来细化</div>
</div>
</div>

<div style="display: flex; align-items: center; gap: 16px;">
<div style="width: 50px; height: 50px; background: linear-gradient(135deg, #fc5c7d 0%, #6a82fb 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">3</div>
<div style="flex: 1; padding: 12px 16px; background: #f5f5f5; border-radius: 8px;">
<strong>本地运行候选方案（测试/运行）</strong>
<div style="font-size: 12px; color: #666;">验证 AI 生成的代码是否正确</div>
</div>
</div>

<div style="display: flex; align-items: center; gap: 16px;">
<div style="width: 50px; height: 50px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">4</div>
<div style="flex: 1; padding: 12px 16px; background: #f5f5f5; border-radius: 8px;">
<strong>团队复审并收录最终 prompt</strong>
<div style="font-size: 12px; color: #666;">将高质量 prompt 纳入团队知识库</div>
</div>
</div>

</div>

</div>
