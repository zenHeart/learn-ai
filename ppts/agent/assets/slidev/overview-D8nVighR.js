import{b as Z,c as G}from"../modules/unplugin-icons-DafS_Hds.js";import{d as j,Y as J,M as R,Q as ee,B as te,r as H,Z as le,b as k,E as ne,A as a,o,k as I,n as F,O as oe,f as _,l as ie,I as se,p as q,R as ae,g as s,F as L,_ as O,i as A,t as w,w as E,$ as ce,e as M,a0 as re,z as W}from"../modules/vue-BgkpjL6v.js";import{u as ue,s as de,j as me,v as ve,w as B,x as fe,y as P,z as pe,C as U,A as he}from"../index-5V_pfmpV.js";import{_ as ge,C as ke}from"./NoteDisplay.vue_vue_type_style_index_0_lang-BcrrC_qM.js";import{S as be,_ as xe,a as _e}from"./SlideWrapper-DgAZZLps.js";import{_ as T}from"./IconButton.vue_vue_type_script_setup_true_lang-CcLLMapr.js";import{u as ye}from"./useSlideInfo-BFe9_Olf.js";import"../modules/shiki-Cux_KVWt.js";const we=["placeholder"],Ce=j({__name:"NoteEditable",props:{no:{type:Number,required:!0},class:{default:""},editing:{default:!1},style:{default:()=>({})},placeholder:{default:"No notes for this slide"},clicksContext:{type:Object},highlight:{default:!0},autoHeight:{default:!1}},emits:["update:editing","markerDblclick","markerClick"],setup(C,{emit:K}){const n=C,y=K,c=te(n,"editing",y,{passive:!0}),{info:h,update:$}=ye(se(n,"no")),m=H("");let S;const{ignoreUpdates:b}=J(m,v=>{if(!c.value)return;const u=n.no;clearTimeout(S),S=setTimeout(()=>{$({note:v},u)},500)});R(()=>h.value?.note,(v="")=>{c.value||(clearTimeout(S),b(()=>{m.value=v}))},{immediate:!0,flush:"sync"});const r=H(),x=H();ee(()=>{c.value&&r.value?.focus()}),le(r,()=>{c.value=!1});function N(){!n.autoHeight||!r.value||!c.value||r.value.scrollHeight>r.value.clientHeight&&(r.value.style.height=`${r.value.scrollHeight}px`)}function V(v){c.value&&v.metaKey&&v.key==="s"&&(v.preventDefault(),$({note:m.value},n.no))}return R([m,c],()=>{q(()=>{N()})},{flush:"post",immediate:!0}),(v,u)=>a(c)?ne((o(),_("textarea",{key:1,ref_key:"inputEl",ref:r,"onUpdate:modelValue":u[2]||(u[2]=g=>m.value=g),class:F(["prose dark:prose-invert resize-none overflow-auto outline-none bg-transparent block border-primary border-2",n.class]),style:I([{"line-height":"1.75"},[n.style,x.value!=null?{height:`${x.value}px`}:{}]]),placeholder:C.placeholder,onKeydown:[u[3]||(u[3]=ie(g=>c.value=!1,["esc"])),V]},null,46,we)),[[oe,m.value]]):(o(),k(ge,{key:0,class:F(["border-transparent border-2",[n.class,m.value?"":"opacity-25 italic select-none"]]),style:I(n.style),note:m.value||C.placeholder,"note-html":a(h)?.noteHTML,"clicks-context":C.clicksContext,"auto-scroll":!C.autoHeight,highlight:n.highlight,onMarkerClick:u[0]||(u[0]=(g,D)=>y("markerClick",g,D)),onMarkerDblclick:u[1]||(u[1]=(g,D)=>y("markerDblclick",g,D))},null,8,["class","style","note","note-html","clicks-context","auto-scroll","highlight"]))}}),$e={class:"h-screen w-screen of-hidden flex"},De={class:"grid grid-rows-[auto_max-content] border-r border-main select-none max-h-full h-full"},Fe={class:"relative"},Se={class:"absolute left-0 top-0 bottom-0 w-200 flex flex-col flex-auto items-end group p2 gap-1 max-h-full of-x-visible of-y-auto",style:{direction:"rtl"}},Ee=["onClick"],Me={p2:"",border:"t main"},He={class:"select-none w-13 text-right my4 flex flex-col gap-1 items-end"},Ne={class:"text-3xl op20 mb2"},Ae=["onDblclick"],Be={class:"py3 mt-0.5 mr--8 ml--4 op0 transition group-hover:op100"},Te={key:0,class:"select-none absolute bottom-0 right-0 bg-main rounded-tl p2 op35 text-xs"},Ie={class:"absolute top-0 right-0 px3 py1.5 border-b border-l rounded-lb bg-main border-main select-none"},Ve={class:"text-xs op50"},z=450,je=j({__name:"overview",setup(C){ue({title:`Overview - ${de}`});const{openInEditor:K,slides:n}=me(),y=ce(new Map),c=H([]),h=H(null),$=W(()=>n.value.map(e=>v(e.meta?.slide?.note||""))),m=W(()=>$.value.reduce((e,t)=>e+t,0)),S=W(()=>n.value.map(e=>N(e)).reduce((e,t)=>e+t,0)),b=re(),r=new WeakMap;function x(e){return r.has(e)||r.set(e,pe(e,U)),r.get(e)}function N(e){return e.meta?.clicks||x(e)?.total}function V(e){b.value===e?b.value=void 0:b.value=e}function v(e){const t=/[\w`'\-\u0392-\u03C9\u00C0-\u00FF\u0600-\u06FF\u0400-\u04FF]+|[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\u3040-\u309F\uAC00-\uD7AF]+/g,i=e.match(t);let f=0;if(!i)return 0;for(let l=0;l<i.length;l++)i[l].charCodeAt(0)>=19968?f+=i[l].length:f+=1;return f}function u(e){const t=e.getBoundingClientRect(),i=20;return t.top>=0-i&&t.left>=0-i&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)+i&&t.right<=(window.innerWidth||document.documentElement.clientWidth)+i}function g(){const e=[];Array.from(y.entries()).forEach(([t,i])=>{u(i)&&e.push(t)}),c.value=e}function D(e){const t=document.createElement("a");t.target="_blank",t.href=he+e.slice(1),t.click()}function Q(e){const t=y.get(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function X(e,t,i){const f=x(i);f.current===t?f.current=U:f.current=t,e.preventDefault()}return ae(()=>{q(()=>{g()})}),(e,t)=>{const i=Z,f=G;return o(),_("div",$e,[s("nav",De,[s("div",Fe,[s("div",Se,[(o(!0),_(L,null,O(a(n),(l,p)=>(o(),_("div",{key:l.no,class:"relative",style:{direction:"ltr"}},[s("button",{class:F(["relative transition duration-300 w-8 h-8 rounded hover:bg-active hover:op100",c.value.includes(p)?"op100 text-primary bg-gray:5":"op20"]),onClick:d=>Q(p)},[s("div",null,w(p+1),1)],10,Ee),l.meta?.slide?.title?(o(),_("div",{key:0,class:F(["pointer-events-none select-none absolute left-110% top-50% translate-y--50% ws-nowrap z-label px2 slidev-glass-effect transition duration-400 op0 group-hover:op100",c.value.includes(p)?"text-primary":"text-main important-text-op-50"])},w(l.meta?.slide?.title),3)):A("v-if",!0)]))),128))])]),s("div",Me,[a(ve)?(o(),k(T,{key:1,title:a(B)?"Dark mode":"Light mode","pointer-events-none":"",op50:""},{default:E(()=>[a(B)?(o(),k(i,{key:0})):(o(),k(f,{key:1}))]),_:1},8,["title"])):(o(),k(T,{key:0,title:a(B)?"Switch to light mode theme":"Switch to dark mode theme",onClick:t[0]||(t[0]=l=>a(fe)())},{default:E(()=>[a(B)?(o(),k(i,{key:0})):(o(),k(f,{key:1}))]),_:1},8,["title"]))])]),s("main",{class:"flex-1 h-full of-auto",style:I(`grid-template-columns: repeat(auto-fit,minmax(${z}px,1fr))`),onScroll:g},[(o(!0),_(L,null,O(a(n),(l,p)=>(o(),_("div",{key:l.no,ref_for:!0,ref:d=>y.set(p,d),class:F(["relative border-t border-main of-hidden flex gap-4 min-h-50 group",p===0?"pt5":""])},[s("div",He,[s("div",Ne,w(p+1),1),M(T,{class:"mr--3 op0 group-hover:op80",title:"Play in new tab",onClick:d=>D(a(P)(l,!1))},{default:E(()=>[...t[2]||(t[2]=[s("div",{class:"i-carbon:presentation-file"},null,-1)])]),_:1},8,["onClick"]),A("v-if",!0)]),s("div",{class:"flex flex-col gap-2 my5",style:I({width:`${z}px`})},[s("div",{class:"border rounded border-main overflow-hidden bg-main select-none h-max",onDblclick:d=>D(a(P)(l,!1))},[(o(),k(_e,{key:l.no,width:z,class:"pointer-events-none important:[&_*]:select-none"},{default:E(()=>[M(be,{"clicks-context":x(l),route:l,"render-context":"overview"},null,8,["clicks-context","route"]),M(xe,{page:l.no},null,8,["page"])]),_:2},1024))],40,Ae),N(l)?(o(),k(ke,{key:0,active:b.value===l,"clicks-context":x(l),class:"w-full mt-2",onDblclick:d=>V(l),onClick:d=>b.value=l},null,8,["active","clicks-context","onDblclick","onClick"])):A("v-if",!0)],4),s("div",Be,[M(T,{title:"Edit Note",class:F(["rounded-full w-9 h-9 text-sm",h.value===l.no?"important:op0":""]),onClick:d=>h.value=l.no},{default:E(()=>[...t[4]||(t[4]=[s("div",{class:"i-carbon:pen"},null,-1)])]),_:1},8,["class","onClick"])]),M(Ce,{no:l.no,class:"max-w-250 w-250 text-lg rounded p3","auto-height":!0,highlight:b.value===l,editing:h.value===l.no,"clicks-context":x(l),onDblclick:d=>h.value!==l.no?h.value=l.no:null,"onUpdate:editing":t[1]||(t[1]=d=>h.value=null),onMarkerClick:(d,Y)=>X(d,Y,l)},null,8,["no","highlight","editing","clicks-context","onDblclick","onMarkerClick"]),$.value[p]>0?(o(),_("div",Te,w($.value[p])+" words ",1)):A("v-if",!0)],2))),128))],36),s("div",Ie,[s("div",Ve,w(a(n).length)+" slides · "+w(S.value+a(n).length-1)+" clicks · "+w(m.value)+" words ",1)])])}}});export{je as default};
