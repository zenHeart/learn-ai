# 3. 协议详解：拆解 MCP 的“三大件”

## JSON-RPC 2.0 基础

MCP 使用轻量级的 JSON-RPC 2.0 作为通信协议。无论是 `stdio` 还是 `SSE`，底层跑的都是这样的 JSON 数据：

<v-clicks>

* **请求**: `{"jsonrpc": "2.0", "method": "tools/list", "id": 1}`
* **响应**: `{"jsonrpc": "2.0", "result": {...}, "id": 1}`
* **错误**: `{"jsonrpc": "2.0", "error": {...}, "id": 1}`

</v-clicks>

---
layout: two-cols-header
---

# 核心概念通俗解构

> MCP 的核心设计极其克制，只定义了三种与外部世界交互的“媒介”：Tools, Resources, Prompts。

::left::

<div class="mt-4 bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg border border-blue-200">

### 🛠️ Tools (工具)：AI 的“手”
**类比：** 让 AI 可以主动点击的按钮。
- **特性**: 包含动作 (Action)，通常会改变外部状态或执行计算。
- **特点**: AI **主动调用**。Server 会告诉 AI：我有 `search_web`, `execute_sql` 这几个工具，你需要的话可以叫我执行。
- **示例**: "调用 `create_jira_issue` 工具，参数是 `title='Fix bug'`"

</div>

::right::

<div class="mt-4 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg border border-green-200">

### 📄 Resources (资源)：AI 的“眼”
**类比：** 摆在 AI 面前的只读文件柜。
- **特性**: 只读的数据源（可以是文件、API 数据、数据库快照）。
- **特点**: 提供**上下文**。用 `uri` 标识（如 `postgres://db/users`）。AI 可以在需要时读取这些资源来获取背景信息。
- **示例**: "读取 `file:///etc/hosts` 资源内容"

</div>

---
layout: default
---

<div class="mt-4 bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg border border-purple-200 w-3/4 mx-auto">

### 🗣️ Prompts (提示词)：AI 的“嘴”
**类比：** 预定义好的工作流话术本。
- **特性**: 结构化的指令模板。
- **特点**: 用户在客户端（如 Cursor）输入斜杠命令调用，自动注入特定的指令和资源。
- **示例**: "执行 `code_review` 提示词，它会自动获取当前 Git diff 作为资源并开始审查。"

</div>

---

# 工具调用 (Tools) 抓包示例

让我们看看一次真实的“手”的交互过程：

<div class="grid grid-cols-2 gap-4 text-sm mt-4">

<div>

**客户端发起调用 (请求)**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "get_weather",
    "arguments": { "city": "Beijing" }
  }
}
```

</div>

<div>

**服务端返回结果 (响应)**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "content": [{
      "type": "text",
      "text": "北京今天天气晴朗，气温25°C"
    }]
  }
}
```

</div>

</div>

---

# 安全模型

既然能读写本地，安全怎么保证？MCP 有三大防线：

<div class="grid grid-cols-3 gap-3 text-sm mt-6">

<div class="bg-orange-50 dark:bg-orange-900/30 p-4 rounded-lg border border-orange-200 dark:border-orange-800">

### 1. 权限边界 (Roots)
**谁能看什么？**
客户端在握手时会发送 `roots/list`，明确告诉 Server：“你只能操作 `/Users/admin/project` 这个目录，越界直接拦截。”

</div>

<div class="bg-cyan-50 dark:bg-cyan-900/30 p-4 rounded-lg border border-cyan-200 dark:border-cyan-800">

### 2. 用户授权 (Approval)
**关键动作拦截**
所有的 `tools/call` 最终是在 Host (如 Cursor) 发起的，IDE 通常会弹窗询问用户：“AI 请求执行 DROP TABLE，是否允许？”

</div>

<div class="bg-pink-50 dark:bg-pink-900/30 p-4 rounded-lg border border-pink-200 dark:border-pink-800">

### 3. 采样隔离 (Sampling)
**Server 请求 AI**
有时 Server 需要借用 AI 的推理能力。MCP 允许 Server 向 Client 发起 `sampling/createMessage` 请求，保证流程可控。

</div>

</div>

---
layout: center
---
# 本章小结：协议

<v-clicks>

1. **三大媒介**: **Tools** (执行动作的“手”)，**Resources** (提供只读上下文的“眼”)，**Prompts** (封装模板的“嘴”)。
2. **轻量级协议**: 基于简单的 JSON-RPC 2.0，不绑定任何特定编程语言。
3. **安全先行**: 严格的 Roots 目录隔离和 Host 端的显式授权机制。

</v-clicks>
