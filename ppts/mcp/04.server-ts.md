# 4. Server 开发 TypeScript

## MCP SDK

```bash
npm install @modelcontextprotocol/sdk
```

---

# 基础 Server 结构

```typescript
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import {
  CallToolRequestSchema,
  ListToolsRequestSchema,
} from '@modelcontextprotocol/sdk/types.js';

const server = new Server(
  { name: 'my-mcp-server', version: '1.0.0' },
  { capabilities: { tools: {} } }
);
```

---

# 定义工具

```typescript
server.setRequestHandler(ListToolsRequestSchema, async () => {
  return {
    tools: [
      {
        name: 'get_weather',
        description: '获取指定城市的天气',
        inputSchema: {
          type: 'object',
          properties: {
            city: { type: 'string', description: '城市名称' }
          },
          required: ['city']
        }
      }
    ]
  };
});
```

---

# 处理工具调用

```typescript
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;

  if (name === 'get_weather') {
    // 实现业务逻辑
    const weather = await fetchWeather(args.city);
    return { content: [{ type: 'text', text: weather }] };
  }

  throw new Error(`Unknown tool: ${name}`);
});
```

---

# 启动服务器

```typescript
const transport = new StdioServerTransport();
await server.connect(transport);
```

<v-click>

**完整示例**: 参考 [Microsoft MCP for Beginners](https://github.com/microsoft/mcp-for-beginners)

</v-click>

---

# 最佳实践

<div class="grid grid-cols-2 gap-4">

* **清晰描述**: 让 AI 理解工具用途

* **完整参数**: 类型、描述、必需项

* **错误处理**: 返回有意义的错误信息

* **类型安全**: 使用 TypeScript 确保类型正确

</div>

---
layout: center
---
# 本章小结：TypeScript 开发

<v-clicks>

1. **安装 SDK**: `npm install @modelcontextprotocol/sdk`
2. **定义工具**: ListToolsRequestSchema
3. **处理调用**: CallToolRequestSchema
4. **启动服务**: StdioServerTransport

</v-clicks>
