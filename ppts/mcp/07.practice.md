# 7. å®æˆ˜åœºæ™¯ï¼šè§£å†³çœŸå®ç—›ç‚¹

> ç†è®ºå¾ˆä¸°æ»¡ï¼Œè½åœ°åˆ°åº•èƒ½å¹²å•¥ï¼Ÿçœ‹çœ‹è¿™ä¸¤ä¸ªç›´å‡»ç ”å‘ç—›ç‚¹çš„åœºæ™¯ã€‚

## åœºæ™¯ 1ï¼šæ•°æ®åº“ç›´æ¥ç”Ÿæˆ CRUD ä»£ç 

**ç—›ç‚¹**: æ–°å»ºä¸€ä¸ªè¡¨åï¼Œè¦æ‰‹åŠ¨å†™ Entityã€DTOã€Controllerã€Serviceï¼Œç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚
**è§£æ³•**: ç”¨ `@modelcontextprotocol/server-postgres` æŒ‚è½½æœ¬åœ°æ•°æ®åº“ã€‚

**æ¼”ç¤ºå·¥ä½œæµ**:
1. åœ¨ Cursor/Claude ä¸­é…ç½® Postgres MCP Serverã€‚
2. è¾“å…¥æç¤ºè¯ï¼š"è¯·æŸ¥çœ‹ `users` å’Œ `orders` è¡¨çš„ç»“æ„ï¼ˆschemaï¼‰ï¼Œå¹¶ä¸ºæˆ‘ç”Ÿæˆå®Œæ•´çš„ NestJS CRUD æ¥å£ä»£ç ï¼ŒåŒ…å« Swagger è£…é¥°å™¨ã€‚"
3. **æ•ˆæœ**: AI è‡ªåŠ¨è°ƒç”¨ `query_database` å·¥å…·æŸ¥è¯¢è¡¨ç»“æ„ï¼ˆå­—æ®µã€ç±»å‹ã€ä¸»å¤–é”®ï¼‰ï¼Œç„¶åä¸€æ¬¡æ€§ç”Ÿæˆ 100% å‡†ç¡®çš„ TS ä»£ç ã€‚

---

## åœºæ™¯ 2ï¼šæ‰“é€š Jira/GitLab è‡ªåŠ¨æ PR

**ç—›ç‚¹**: ä¿®å¤ Bug éœ€è¦åˆ‡åˆ†æ”¯ã€æŸ¥ Jira å•å·ã€å†™é•¿é•¿çš„ Commit Messageï¼Œæœ€åè¿˜è¦å»æµè§ˆå™¨é‡Œæ PRã€‚
**è§£æ³•**: å¼€å‘ä¸€ä¸ªå¯¹æ¥å†…éƒ¨ Jira å’Œ GitLab çš„ä¼ä¸šçº§ MCP Serverã€‚

**æ¼”ç¤ºå·¥ä½œæµ**:
1. å¼€å‘è€…åœ¨ç»ˆç«¯è¾“å…¥ï¼š`ä¿®å¤äº†ç™»å½•é¡µçš„ç©ºæŒ‡é’ˆæŠ¥é”™ï¼Œè¯·å¸®æˆ‘æäº¤ä»£ç å¹¶å…³è” Jira å•å· WEB-1024`ã€‚
2. **AI è‡ªåŠ¨æ‰§è¡Œ**:
   - è°ƒç”¨ `jira_get_issue` è·å– WEB-1024 çš„è¯¦æƒ…ã€‚
   - è°ƒç”¨æœ¬åœ° `bash` å·¥å…·åˆ›å»ºåˆ†æ”¯ã€Git commitã€‚
   - è°ƒç”¨ `gitlab_create_mr` åˆ›å»ºåˆå¹¶è¯·æ±‚ï¼Œå¹¶å°† Jira çš„æ ‡é¢˜å’Œæè¿°è‡ªåŠ¨å¡«å…¥ PR æè¿°ä¸­ã€‚
3. **æ•ˆæœ**: æ•´ä¸ªæµæ°´çº¿è¢« AI ä¸€é”®æ¥ç®¡ï¼Œç ”å‘ä¸“æ³¨æ•²ä»£ç ã€‚

---

# å¼€å‘è‡ªå®šä¹‰ MCP Server å®æˆ˜ (Node.js)

å¦‚æœå®˜æ–¹æ²¡æœ‰æä¾›ï¼Œå¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªï¼Ÿ

```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";

// 1. åˆå§‹åŒ– Server
const server = new McpServer({ name: "my-internal-tools", version: "1.0.0" });

// 2. æ³¨å†Œ Tool (AI çš„â€œæ‰‹â€)
server.tool(
  "query_jira",
  { issueId: z.string().describe("Jira ä»»åŠ¡ç¼–å·ï¼Œå¦‚ PROJ-123") },
  async ({ issueId }) => {
    // ä½ çš„ä¸šåŠ¡é€»è¾‘ï¼šè¯·æ±‚å†…éƒ¨ Jira API
    const data = await fetchJiraTicket(issueId); 
    return { content: [{ type: "text", text: JSON.stringify(data) }] };
  }
);

// 3. å¯åŠ¨é€šä¿¡å±‚ (stdio)
const transport = new StdioServerTransport();
await server.connect(transport);
console.log("MCP Server running on stdio");
```

<div class="mt-4 p-4 bg-yellow-50 text-yellow-800 rounded-lg text-sm border border-yellow-200">
<strong>æ ¸å¿ƒå¿ƒæ³•</strong>: å†™ MCP Tool å°±åƒå†™å¸¦ Zod æ ¡éªŒçš„æ™®é€š API æ¥å£ã€‚åªè¦æè¿° (Description) å†™å¾—å¥½ï¼ŒAI å°±èƒ½è‡ªå·±æ¨æ–­å‡ºä»€ä¹ˆæ—¶å€™è¯¥è°ƒç”¨å®ƒã€‚
</div>

---

# âš¡ ç”Ÿäº§éƒ¨ç½²å®æˆ˜

> MCP ä¸ä»…è¦èƒ½å¼€å‘ï¼Œè¿˜è¦èƒ½ä¸Šçº¿ã€‚è¿™é‡Œæ˜¯ç”Ÿäº§ç¯å¢ƒçš„å®æˆ˜ç»éªŒã€‚

## é—®é¢˜ 1ï¼šè¿œç¨‹éƒ¨ç½²å¦‚ä½•ä¿è¯å®‰å…¨ï¼Ÿ

### æ–¹æ¡ˆï¼šä½¿ç”¨ Streamable HTTP + OAuth 2.0

```typescript
// Streamable HTTP Server ç¤ºä¾‹
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StreamableHTTPServerTransport } from '@modelcontextprotocol/sdk/server/streamable-http.js';

const transport = new StreamableHTTPServerTransport({
  port: 3000,
  // ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½® HTTPS
  https: {
    key: fs.readFileSync('/path/to/key.pem'),
    cert: fs.readFileSync('/path/to/cert.pem')
  }
});

await server.connect(transport);
```

### OAuth 2.0 è®¤è¯é…ç½®

```json
{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_TOKEN": "xxx"
      },
      "auth": {
        "type": "oauth",
        "clientId": "your-client-id",
        "clientSecret": "your-client-secret",
        "scopes": ["repo", "user"]
      }
    }
  }
}
```

---

## é—®é¢˜ 2ï¼šå¦‚ä½•å¤„ç†è¶…æ—¶å’Œé”™è¯¯ï¼Ÿ

### æ–¹æ¡ˆï¼šå®ç°é‡è¯• + é™çº§ç­–ç•¥

```typescript
// é”™è¯¯å¤„ç†æœ€ä½³å®è·µ
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;

  try {
    // è®¾ç½®è¶…æ—¶
    const result = await withTimeout(
      executeTool(name, args),
      30000 // 30 ç§’è¶…æ—¶
    );
    return { content: [{ type: 'text', text: result }] };
  } catch (error) {
    // è¿”å›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ© AI ç†è§£å’Œé‡è¯•
    return {
      content: [{
        type: 'text',
        text: JSON.stringify({
          error: true,
          message: error.message,
          retryable: error.code === 'TIMEOUT' || error.code === 'RATE_LIMIT'
        })
      }]
    };
  }
});

// æŒ‡æ•°é€€é¿é‡è¯•
async function withRetry(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(Math.pow(2, i) * 1000); // æŒ‡æ•°é€€é¿
    }
  }
}
```

---

## é—®é¢˜ 3ï¼šå¦‚ä½•ç›‘æ§å’Œè°ƒè¯•ï¼Ÿ

### æ–¹æ¡ˆï¼šå®Œå–„çš„æ—¥å¿—ä½“ç³»

```typescript
// Request ID è¿½è¸ª
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const requestId = crypto.randomUUID();

  console.log(JSON.stringify({
    requestId,
    method: 'tools/call',
    tool: request.params.name,
    timestamp: new Date().toISOString()
  }));

  try {
    const result = await executeTool(request.params);
    console.log(JSON.stringify({
      requestId,
      status: 'success',
      duration: Date.now() - start
    }));
    return result;
  } catch (error) {
    console.log(JSON.stringify({
      requestId,
      status: 'error',
      error: error.message
    }));
    throw error;
  }
});
```

---

## ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | è¯´æ˜ |
|--------|------|
| âœ… HTTPS è¯ä¹¦ | ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS |
| âœ… è¯·æ±‚è¶…æ—¶ | å»ºè®® 30 ç§’è¶…æ—¶ |
| âœ… é”™è¯¯é‡è¯• | å®ç°æŒ‡æ•°é€€é¿é‡è¯• |
| âœ… æ—¥å¿—è¿½è¸ª | æ¯ä¸ªè¯·æ±‚å¸¦ Request ID |
| âœ… ç›‘æ§å‘Šè­¦ | æ¥å…¥ä¼ä¸šç›‘æ§å¹³å° |
| âœ… é™æµä¿æŠ¤ | é˜²æ­¢æ¶æ„è¯·æ±‚ |

---

# ğŸ‰ MCP ç”Ÿæ€èµ„æº

## Awesome MCP Servers

> GitHub ä¸Šå·²æœ‰ **1000+** MCP Server å¯ä¾›ä½¿ç”¨ã€‚

| ç±»åˆ« | ä»£è¡¨ Server | è¯´æ˜ |
|------|-------------|------|
| **æ•°æ®åº“** | server-postgres, server-mysql | ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ |
| **GitHub** | server-github | PRã€Issueã€ä»£ç æœç´¢ |
| **æµè§ˆå™¨** | server-puppeteer | æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| **æ–‡ä»¶** | server-filesystem | æ–‡ä»¶ç³»ç»Ÿæ“ä½œ |
| **æœç´¢** | server-brave-search | Web æœç´¢ |

**æŸ¥æ‰¾èµ„æº**: [Awesome MCP Servers](https://github.com/punkpeye/awesome-mcp-servers)

